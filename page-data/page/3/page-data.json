{"componentChunkName":"component---src-templates-post-pagination-jsx","path":"/page/3/","result":{"data":{"paging":{"group":[{"fieldValue":"AWS","totalCount":2},{"fieldValue":"디자인 패턴","totalCount":3},{"fieldValue":"스프링","totalCount":2},{"fieldValue":"카프카","totalCount":3}],"nodes":[{"excerpt":"복잡한 Service 계층 Service 계층은 애플리케이션의 핵심 비즈니스 로직을 수행하는 중심적인 역할을 한다.\n이 계층은 데이터 유효성 검증, 복잡한 계산 로직, 데이터베이스 CRUD 연산, 외부 API 통신, 그리고 트랜잭션 관리까지 다양한 책임을 지니고 있다.\n실무에서 코드를 파악할 일이나 유지보수할 일이 생기면 가장 먼저 찾고 코드를 보는데 많…","html":"<h2 id=\"복잡한-Service-계층\" style=\"position:relative;\">복잡한 Service 계층<a href=\"#%EB%B3%B5%EC%9E%A1%ED%95%9C-Service-%EA%B3%84%EC%B8%B5\" aria-label=\"복잡한 Service 계층 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Service 계층은 애플리케이션의 핵심 비즈니스 로직을 수행하는 중심적인 역할을 한다.\n이 계층은 데이터 유효성 검증, 복잡한 계산 로직, 데이터베이스 CRUD 연산, 외부 API 통신, 그리고 트랜잭션 관리까지 다양한 책임을 지니고 있다.\n실무에서 코드를 파악할 일이나 유지보수할 일이 생기면 가장 먼저 찾고 코드를 보는데 많은 시간을 할애하는 부분이 서비스 계층이기도 하다.</p>\n<p>Service 계층은 애플리케이션의 비즈니스 로직을 수행하는 곳이기 때문에, 여기에 구현 코드가 위치하는 것은 자연스럽다.\n다만, 비지니스 로직이 매우 복잡하고 하나의 Service에서 많은 유스케이스를 처리하게 되면 유지보수가 어려워진다.\n실제로 복잡한 시스템은 Service 로직 하나가 몇 1000줄씩 필요한 경우도 있다.</p>\n<p>비즈니스 로직의 실행에 필요한 절차적 논리와 연산은 프로그래밍 패러다임(절차적, 객체지향 등)에 관계없이 동일하다.\n그러나 이러한 로직을 유지보수 가능한 형태로 구성하기 위해서는 객체지향적 설계 원칙을 적용하는 것이 효과적이다.</p>\n<p>이 글에서는 Collection Wrapper 클래스를 활용하여 절차적으로 구성된 Service 계층의 코드를 객체지향적으로 리팩토링하는 방법을 소개하려고 한다.\nCollection Wrapper 클래스는 컬렉션에 대한 연산을 캡슐화하여 코드의 가독성과 유지보수성을 향상시킬 수 있다.</p>\n<h2 id=\"절차적인-구현과-객체지향적-구현의-비교\" style=\"position:relative;\">절차적인 구현과 객체지향적 구현의 비교<a href=\"#%EC%A0%88%EC%B0%A8%EC%A0%81%EC%9D%B8-%EA%B5%AC%ED%98%84%EA%B3%BC-%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5%EC%A0%81-%EA%B5%AC%ED%98%84%EC%9D%98-%EB%B9%84%EA%B5%90\" aria-label=\"절차적인 구현과 객체지향적 구현의 비교 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Product</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token annotation punctuation\">@Id</span> <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> price<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ProductJpaRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductService</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ProductJpaRepository</span> productJpaRepository<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">getTotalPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t\t<span class=\"token comment\">// 여기에 우리의 핵심 비지니스 로직인 상품 가격의 합계 계산 로직을 구현한다.</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"전통적인-절차적인-구현\" style=\"position:relative;\">전통적인 절차적인 구현<a href=\"#%EC%A0%84%ED%86%B5%EC%A0%81%EC%9D%B8-%EC%A0%88%EC%B0%A8%EC%A0%81%EC%9D%B8-%EA%B5%AC%ED%98%84\" aria-label=\"전통적인 절차적인 구현 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductService</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">getTotalPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products <span class=\"token operator\">=</span> productJpaRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token class-name\">Integer</span> totalPrice <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Product</span> product <span class=\"token operator\">:</span> <span class=\"token class-name\">Products</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\ttotalPrice <span class=\"token operator\">+=</span> product<span class=\"token punctuation\">.</span><span class=\"token function\">getPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\t<span class=\"token keyword\">return</span> price<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>DB로부터 상품을 조회해온 뒤, 컬렉션 원소를 돌면서 <code class=\"language-text\">totalPrice</code> 라는 로컬 변수에 상품 가격의 합계금액을 누적한다.</p>\n<h3 id=\"Stream-API를-이용한-함수형-프로그래밍-구현\" style=\"position:relative;\">Stream API를 이용한 함수형 프로그래밍 구현<a href=\"#Stream-API%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%95%A8%EC%88%98%ED%98%95-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%EA%B5%AC%ED%98%84\" aria-label=\"Stream API를 이용한 함수형 프로그래밍 구현 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductService</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">getTotalPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products <span class=\"token operator\">=</span> productJpaRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> products<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>                  <span class=\"token comment\">// (1)</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Product</span><span class=\"token operator\">::</span><span class=\"token function\">getPrice</span><span class=\"token punctuation\">)</span>          <span class=\"token comment\">// (2)</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Intger</span><span class=\"token operator\">::</span><span class=\"token function\">sum</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>         <span class=\"token comment\">// (3)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>함수형 프로그래밍 스타일로 구현하였지만, 여전히 코드에서 합계금액을 계산하기 위한 절차를 기술하고 있다.</p>\n<ul>\n<li><strong>(1)</strong> List<Product> products 를 Stream 으로 반환한다. <code class=\"language-text\">(레코드를 건건히 처리할 것이다)</code></li>\n<li><strong>(2)</strong> Product 타입을 getPrice() 로 Integer 타입으로 변환한다.</li>\n<li><strong>(3)</strong> Integer로 변환된 값을 0부터 누적시켜 합을 구한다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"객체지향적인-구현\" style=\"position:relative;\">객체지향적인 구현<a href=\"#%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5%EC%A0%81%EC%9D%B8-%EA%B5%AC%ED%98%84\" aria-label=\"객체지향적인 구현 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductService</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">getTotalPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">Products</span> products <span class=\"token operator\">=</span> productJpaRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> products<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Products 라는 List<Product> 의 Wrapper 클래스를 만들었다.</li>\n<li>서비스 계층에서는 Products 라는 Collection Wrapper 클래스에게 상품의 합계금액을 계산하라는 메시지를 보낸다.</li>\n<li>서비그 계층에서는 세부 구현 코드를 숨기고 구현의 대한 추상화를 제공한다.</li>\n</ul>\n<h3 id=\"Collection-Wrapper-클래스-구현\" style=\"position:relative;\">Collection Wrapper 클래스 구현<a href=\"#Collection-Wrapper-%ED%81%B4%EB%9E%98%EC%8A%A4-%EA%B5%AC%ED%98%84\" aria-label=\"Collection Wrapper 클래스 구현 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Products</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Iterable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Stream</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> stream<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span> <span class=\"token keyword\">public</span> <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> stream<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">getTotalPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> stream\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Product</span><span class=\"token operator\">::</span><span class=\"token function\">getPrice</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token operator\">::</span><span class=\"token function\">sum</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">Iterable&lt;Product></code> 인터페이스를 구현한 Products 클래스를 정의한다.</li>\n<li><code class=\"language-text\">Iterable</code> 은 컬렉션의 구현 방법을 노출시키지 않고, 컬렉션 요소들을 접근할 수 있게 하는 패턴,인터페이스다.</li>\n<li><code class=\"language-text\">Iterable</code> 인터페이스를 구현하면 <code class=\"language-text\">for-each</code> 문 사용이 가능해지고, <code class=\"language-text\">Iterable</code> 를 통해 Products 래퍼클래스의 요소들을 순회할 수 있게 하였다.</li>\n</ul>\n<h2 id=\"실전-예제로-보는-리팩토링\" style=\"position:relative;\">실전 예제로 보는 리팩토링<a href=\"#%EC%8B%A4%EC%A0%84-%EC%98%88%EC%A0%9C%EB%A1%9C-%EB%B3%B4%EB%8A%94-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81\" aria-label=\"실전 예제로 보는 리팩토링 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>실무에서 자주 사용되는 upsert 로직을 구현한다고 가정해보자.\n먼저 UserDto 객체를 입력으로 받는다.\n이 입력된 UserDto는 User 엔티티의 ID 값으로 변환된다.\n이 변환된 ID 값을 사용하여 데이터베이스에 조회한다.\n만약 조회 결과 해당 ID를 가진 User 엔티티가 데이터베이스에 없다면 새로운 User를 생성한다.\n반대로 이미 해당 ID를 가진 User 엔티티가 데이터베이스에 존재한다면, 이 엔티티를 업데이트한다.</p>\n<h3 id=\"절자적으로-구현된-upsert\" style=\"position:relative;\">절자적으로 구현된 upsert<a href=\"#%EC%A0%88%EC%9E%90%EC%A0%81%EC%9C%BC%EB%A1%9C-%EA%B5%AC%ED%98%84%EB%90%9C-upsert\" aria-label=\"절자적으로 구현된 upsert permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token annotation punctuation\">@Autowired</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upsertUsers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UserDto</span><span class=\"token punctuation\">></span></span> userDtos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> userIds <span class=\"token operator\">=</span> userDtos<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDto</span><span class=\"token operator\">::</span><span class=\"token function\">getId</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> existingUsers <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAllById</span><span class=\"token punctuation\">(</span>userIds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> existingUserMap <span class=\"token operator\">=</span> existingUsers<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token operator\">::</span><span class=\"token function\">getId</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Function</span><span class=\"token punctuation\">.</span><span class=\"token function\">identity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> usersToSave <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDto</span> dto <span class=\"token operator\">:</span> userDtos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> existingUserMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tuser<span class=\"token punctuation\">.</span><span class=\"token function\">updateFromDto</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tuser <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\tusersToSave<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\tuserRepository<span class=\"token punctuation\">.</span><span class=\"token function\">saveAll</span><span class=\"token punctuation\">(</span>usersToSave<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Service 계층에서는 UserDto를 입력받아, 해당 데이터가 데이터베이스에 이미 존재하면 업데이트하고, 그렇지 않으면 새로 삽입하는 \"upsert\" 로직이 구현되어 있다.\n이러한 접근 방식은 코드의 복잡성을 증가시키며, 특히 Service 계층의 코드가 수천 줄에 이르면 이해와 유지보수가 어려워진다.</p>\n<p>또한, Map&#x3C;Long, User> existingUserMap과 같은 구체적인 자료구조를 private 메서드에 인자로 전달하는 경우가 많다.\n이렇게 되면, Long 타입의 키가 어떤 의미를 가지는지를 코드를 읽는 동안 인지하고 있어야 한다.\n이는 코드의 가독성을 저하시키고, 이해하는 데에 추가적인 노력이 필요하게 된다.</p>\n<h3 id=\"개선-후-upsert\" style=\"position:relative;\">개선 후 upsert<a href=\"#%EA%B0%9C%EC%84%A0-%ED%9B%84-upsert\" aria-label=\"개선 후 upsert permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserCollection</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> users<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UserCollection</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> users<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>users <span class=\"token operator\">=</span> users<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UpsertResult</span> <span class=\"token function\">upsertFromDtos</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UserDto</span><span class=\"token punctuation\">></span></span> dtos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> userMap <span class=\"token operator\">=</span> users<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token operator\">::</span><span class=\"token function\">getId</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Function</span><span class=\"token punctuation\">.</span><span class=\"token function\">identity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> updatedUsers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> insertedUsers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDto</span> dto <span class=\"token operator\">:</span> dtos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tuser<span class=\"token punctuation\">.</span><span class=\"token function\">updateFromDto</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                updatedUsers<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tuser <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                insertedUsers<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UpsertResult</span><span class=\"token punctuation\">(</span>updatedUsers<span class=\"token punctuation\">,</span> insertedUsers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UpsertResult</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> updatedUsers<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> insertedUsers<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UpsertResult</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> updatedUsers<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> insertedUsers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>updatedUsers <span class=\"token operator\">=</span> updatedUsers<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>insertedUsers <span class=\"token operator\">=</span> insertedUsers<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token annotation punctuation\">@Autowired</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upsertUsers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UserDto</span><span class=\"token punctuation\">></span></span> userDtos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> existingUsers <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAllById</span><span class=\"token punctuation\">(</span>\n\t\t\t\tuserDtos<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDto</span><span class=\"token operator\">::</span><span class=\"token function\">getId</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token class-name\">UserCollection</span> userCollection <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserCollection</span><span class=\"token punctuation\">(</span>existingUsers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">UpsertResult</span> result <span class=\"token operator\">=</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">upsertFromDtos</span><span class=\"token punctuation\">(</span>userDtos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\tuserRepository<span class=\"token punctuation\">.</span><span class=\"token function\">saveAll</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>updatedUsers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tuserRepository<span class=\"token punctuation\">.</span><span class=\"token function\">saveAll</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>insertedUsers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>리팩토링 후의 코드에서는 UserDto를 데이터베이스에 업데이트할지, 새로 삽입할지 결정하는 로직이 UserCollection 클래스로 이동되었다.\n이로 인해 UserService는 이제 UserCollection에 구체적인 작업을 위임하고, 그 결과만을 데이터베이스에 반영하게 된다.\n추가적으로, 'upsert' 로직에 다른 연산이 필요한 경우에도 UserCollection을 파라미터로 전달하는 방식을 사용할 수 있다.\n이렇게 하면, 구체적인 자료구조 대신 추상화된 UserCollection을 사용하여 더 높은 수준의 추상화와 캡슐화를 달성할 수 있게 된다.</p>\n<h2 id=\"Spring-Data-JPA-와의-연동\" style=\"position:relative;\">Spring Data JPA 와의 연동<a href=\"#Spring-Data-JPA-%EC%99%80%EC%9D%98-%EC%97%B0%EB%8F%99\" aria-label=\"Spring Data JPA 와의 연동 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Spring Data JPA 에서 위와 같은 패턴을 구현하려면 Spring Data JPA에 메서드 이름의 키워드를 보고 자동으로 쿼리 메서드를 만들어주는 Query Method 기능과 연동되어야 한다.\n다행히 Spring Data JPA 에는 Query Method 에서는 여러 반환값을 지원하고 있으며, Streamable 인터페이스를 구현한 클래스를 반환값으로 받을 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Streamable</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Products</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Streamable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Streamable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> streamable<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> streamable<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">ProductJpaRepository</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token class-name\">Products</span> <span class=\"token function\">findByPriceGreaterThan</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> price<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">ProductJpaRepository</code> 에 반환값이 Streamable 인터페이스를 구현한 <code class=\"language-text\">ProductsSCO</code> 래퍼 클래스 인 것을 볼 수 있다.\n다만, <code class=\"language-text\">List&lt;T> findAll()</code> 과 같은 메서드들은 이미 <code class=\"language-text\">JpaRepository</code>에서 정의되기 때문에 <code class=\"language-text\">Products findAll()</code> 과 같은 형태로 재정의 할 수 없다.</p>\n<h2 id=\"참조\" style=\"position:relative;\">참조<a href=\"#%EC%B0%B8%EC%A1%B0\" aria-label=\"참조 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><a href=\"https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables.streamable-wrapper\">Spring Data JPA - Reference Documentation</a></p>","fields":{"slug":"/java-collection-wrapper/","thumbnail":null},"frontmatter":{"date":"June 23, 2023","update":"Jun 23, 2023","title":"Collection Wrapper 클래스를 이용한 Service 계층 리팩토링 ","description":null,"tags":["스프링"],"thumbnail":null}},{"excerpt":"1. 개요 일반적으로 Spring 환경에서 Amazon SQS 라이브러리로  모듈을 사용합니다.  을 분석하고, 단점을 보완한 모듈을 설계하는 것을 목표로 합니다. 2. Spring Cloud AWS Messaging 모듈  모듈을 사용하면 를 추상화한 API를 사용해 쉽게 와 를 구현할 수 있습니다. 아래와 같이 간단한 설정만으로 Consumer의 경우…","html":"<h1><strong>1. 개요</strong></h1>\n<ul>\n<li>일반적으로 Spring 환경에서 Amazon SQS 라이브러리로 <code class=\"language-text\">spring-cloud-aws-messaging</code> 모듈을 사용합니다.</li>\n<li><code class=\"language-text\">spring-cloud-aws-messaging</code> 을 분석하고, 단점을 보완한 모듈을 설계하는 것을 목표로 합니다.</li>\n</ul>\n<!-- more -->\n<h1><strong>2. Spring Cloud AWS Messaging 모듈</strong></h1>\n<ul>\n<li><code class=\"language-text\">spring-cloud-aws-messaging</code> 모듈을 사용하면 <code class=\"language-text\">Amazon SQS SDK</code>를 추상화한 API를 사용해 쉽게 <code class=\"language-text\">Producer</code>와 <code class=\"language-text\">Consumer</code>를 구현할 수 있습니다.</li>\n<li>아래와 같이 간단한 설정만으로 Consumer의 경우 Polling Thread Pool을 자동으로 만들어주고, <code class=\"language-text\">@SqsListener</code> 어노테이션을 통해 특정 큐를 구독하여 메시지를 처리할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\"># build<span class=\"token punctuation\">.</span>gradle\ndependencies <span class=\"token punctuation\">{</span>\n    implementation <span class=\"token string\">'org.springframework.cloud:spring-cloud-aws-autoconfigure:2.2.1.RELEASE'</span>\n    implementation <span class=\"token string\">'org.springframework.cloud:spring-cloud-aws-messaging:2.2.1.RELEASE'</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SqsConfig</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AWSCredentialsProvider</span> awsCredentialsProvider<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${cloud.aws.region.static}\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> region<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation punctuation\">@Bean</span>\n\t<span class=\"token annotation punctuation\">@Primary</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">AmazonSQSAsync</span> <span class=\"token function\">amazonSQSAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">AmazonSQSAsyncClientBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">standard</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withCredentials</span><span class=\"token punctuation\">(</span>awsCredentialsProvider<span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">withRegion</span><span class=\"token punctuation\">(</span>region<span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">/**\n* Consumer 설정 클래스\n*/</span>\n<span class=\"token annotation punctuation\">@Configration</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SqsConsumeConfig</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AmazonSQSAsync</span> amazonSQSAsync<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n    *  Consumer 에서 SQS Queue로 폴링하는 컨테이너를 설정합니다.\n    **/</span>\n\t<span class=\"token annotation punctuation\">@Bean</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">SimpleMessageListenerContainerFactory</span> <span class=\"token function\">simpleMessageListenerContainerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">SimpleMessageListenerContainerFactory</span> factory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleMessageListenerContainerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tfactory<span class=\"token punctuation\">.</span><span class=\"token function\">setAmazonSqs</span><span class=\"token punctuation\">(</span>amazonSQSAsync<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setMaxNumberOfMessages</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setWaitTimeOut</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setBackOffTime</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token number\">60000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> factory<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>SQS 큐를 Polling 하는 핵심 매커니즘을 <code class=\"language-text\">SimpleMessageListenerContainer</code>를 정의할 수 있습니다.</p>\n<ul>\n<li><strong>WaitTimeOut</strong> :- 현재 대기열에 메시지가 없는 경우 폴링 요청이 새 메시지가 도착할 때까지 기다리는 대기 시간 제한을 구성합니다. 값이 높을수록 시스템에 대한 폴링 요청이 크게 줄어듭니다.</li>\n<li><strong>MaxNumberOfMessage :</strong> Amazon SQS 시스템에 대한 한 번의 폴링 중에 검색해야 하는 최대 메시지 수를 구성합니다. 최대 메시지 수(1–10)</li>\n<li><strong>BackOffTime:-</strong> 폴링 스레드가 오류 발생 시 복구를 시도하기 전에 대기해야 하는 밀리초 수입니다. 이렇게 하면 작업자가 용량을 초과하는 요청에 압도당하는 것을 방지할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SqsMessageListener</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">/**\n    * 폴링 스레드에서 핸들링한 메시지가 @SqsListener 로 넘어옵니다.\n    **/</span>\n\t<span class=\"token annotation punctuation\">@SqsListener</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"QueueName\"</span><span class=\"token punctuation\">,</span> deletionPolicy <span class=\"token operator\">=</span> <span class=\"token class-name\">SqsMessageDeletionPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NEVER</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Payload</span> <span class=\"token class-name\">ApplicationEventMessage</span> message<span class=\"token punctuation\">,</span> <span class=\"token class-name\">MessageHeaders</span> messageHeaders<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Acknowledgment</span> acknowledgment<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" received Message from SQS queue\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">/**\n* Producer 설정 클래스\n*/</span>\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SqsPublishConfig</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AmazonSQSAsync</span> amazonSQSAsync<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ObjectMapper</span> objectMapper<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation punctuation\">@Bean</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">QueueMessagingTemplate</span> <span class=\"token function\">queueMessagingTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueueMessagingTemplate</span><span class=\"token punctuation\">(</span>amazonSQSAsync<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token annotation punctuation\">@Bean</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">StringHttpMessageConverter</span> <span class=\"token function\">stringHttpMessageConverter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringHttpMessageConverter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FooService</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">QueueMessagingTemplate</span> queueMessagingTemplate<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">publih</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function\">queueMessageTemplate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queueName\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"1-SimpleMessageListenerContainer\" style=\"position:relative;\"><strong>1. SimpleMessageListenerContainer</strong><a href=\"#1-SimpleMessageListenerContainer\" aria-label=\"1 SimpleMessageListenerContainer permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li><code class=\"language-text\">spring-cloud-aws-messaging</code> 모듈을 사용하면 <code class=\"language-text\">SimpleMessageListenerContainer</code> 라는 클래스가 SQS 큐에서 메시지를 폴링하여 <code class=\"language-text\">@SqsHandler</code> 에게 넘깁니다.</li>\n<li><code class=\"language-text\">SimpleMessageListenerContainer</code> 는 Polling 을 위한 스레드풀을 별도로 생성하여 동작합니다.</li>\n<li>\n<p>Polling 스레드풀의 스레드 갯수는 아래 공식으로 결정됩니다.</p>\n<ul>\n<li>\n<p><strong>등록된 큐의 개수 * ( 폴링 시 한번에 받을 수 있는 최대 메시지 수 + 1)</strong></p>\n<ul>\n<li>ex) 등록된 큐의 개수가 1개이고, 폴링 시 한번에 받을 수 있는 최대 메시지 수가 10개이면 <code class=\"language-text\">1 * (10 + 1) = 11개</code>의 폴링 스레드가 생성됩니다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/00da5f863fd101c9f3d5ff4268db761a/5d9a4/Untitled.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzElEQVR42k1RCY7bMAz0Z7KJdZI6SEm2bMcpsvFm+//vlEmBbQeDwYiQ6SE1FFQNLpkocePSqNSU0kRun6CzW6vfmp/ZpRSMsUqN6gdaD0x56b1MvS7X0ua+7vO6L+tKGQFdQC9MYAICYPAgQFHnvbN2CJnbdqt9a8smSrXnOpV+pWnhvuXWLUa0l4guccnMmQu9TEHEwVobuOZ+xTIVihSR2ywp2ryknFuZa2oJiWMjZGFGdsaM40WCD9GNISDmgplDyhKSQXFtMoK0r20udSbiWueAwRoJ62V4/cYAVkkAB8FhELX+NY8xRv8HpdWLL4xifuqDDJ6k97KzLGy95XnFRMa+/iEqcNaL81Yu+rf/13fQxihtcibmSu9lhEQQs7SAkGTZGShBKqG+NNYAKFH+Nhgkv/faxPyPiWwmLU+SKdYWSgmlIRcgVvJgoIwzZ9mZfJy02py9t/697s91P5btq2+PqW8Aj1iO1ITPPP+m9VOOoR0Qp8tHPZ/DOA7fHx+7g0eZnrUfdTpK2zFu1glXY1dtrg42698V//bQtfml9dfpNNyUup1OD+efGA/nDw936970d+Pu2nx6vDt/d/DpQFTqN2UOrbfz+Q84JZFq9UYj4QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/00da5f863fd101c9f3d5ff4268db761a/ca1dc/Untitled.png\"\n        srcset=\"/static/00da5f863fd101c9f3d5ff4268db761a/e7570/Untitled.png 170w,\n/static/00da5f863fd101c9f3d5ff4268db761a/f46e7/Untitled.png 340w,\n/static/00da5f863fd101c9f3d5ff4268db761a/ca1dc/Untitled.png 680w,\n/static/00da5f863fd101c9f3d5ff4268db761a/02d09/Untitled.png 1020w,\n/static/00da5f863fd101c9f3d5ff4268db761a/9d567/Untitled.png 1360w,\n/static/00da5f863fd101c9f3d5ff4268db761a/5d9a4/Untitled.png 1626w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<h2 id=\"2-SimpleMessageListenerContainer-의-문제\" style=\"position:relative;\"><strong>2. SimpleMessageListenerContainer 의 문제</strong><a href=\"#2-SimpleMessageListenerContainer-%EC%9D%98-%EB%AC%B8%EC%A0%9C\" aria-label=\"2 SimpleMessageListenerContainer 의 문제 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d7902636fe64116f866fd153d196fb07/78873/Untitled_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85.88235294117648%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsTAAALEwEAmpwYAAACLklEQVR42oWTiW6bQBCG/SyJYWfvA/bgMGAum8jkaPv+z9IlUdKYqir6hFYr/TvHP3MwmtQFchkoTjhnlBBG6b/YfQctaO9Q5WXTVqFutPVMKqAUKIng7UCBkA1KyU4MjFcEViknLmfKL5wPhLxDR0IHwCMmM2ORM8ac3MkPmPMOoDRZfWqmcR6Gq7Mhy5z1hQ2VyZ33oSzrPJQTwQEAGPsWmfMJoZXyVcufRj8r92zCKu3N2Ld449yv8vTDF4tULw8Pxd/iHtArZzdX3GxYcr8Yu1r/VtSv1r3kLv6fpJoZvyEUMMbf02bxJUY7RV77ce3npT1PRdVmts1dm7lWm9660YfBukqIfbc5YzGTCfCq1dXml8xNxo3GddI0WwuPS5Zd8jBl/spEj1L8zbJNTBjrMCl8CG3rT72ru3DqQ1W47uybtqhPvu5s1Tpjb8cj20VOY9kYFkoHZUapBiF6yiYhJqkjY3waUIvxOU1jwzD707HNqhbQAumF0WhpNHYAmCmdCemT4zk59mkSZXOSLEmyG7JN3KMoxjHmHBFy5vxJ6UXpAdIzSmOdHUqndBPz+xk7xIIdjfMEVZrW71Sf1Ah90SCU3/v0OSQxK8pak7dSN1wM0R4hNz3AByVAh9Db46Mkd/O5RbaE3BS5WHv15VNRRWbrYvMaQr70NUCMvF+M2LxonTCZsk7mVjtvfIhn7YMwBt6n4APM9kt5oIxpKbRgnAsp1XYXU9vA/93n36e/w/dh43BCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/d7902636fe64116f866fd153d196fb07/ca1dc/Untitled_1.png\"\n        srcset=\"/static/d7902636fe64116f866fd153d196fb07/e7570/Untitled_1.png 170w,\n/static/d7902636fe64116f866fd153d196fb07/f46e7/Untitled_1.png 340w,\n/static/d7902636fe64116f866fd153d196fb07/ca1dc/Untitled_1.png 680w,\n/static/d7902636fe64116f866fd153d196fb07/02d09/Untitled_1.png 1020w,\n/static/d7902636fe64116f866fd153d196fb07/9d567/Untitled_1.png 1360w,\n/static/d7902636fe64116f866fd153d196fb07/78873/Untitled_1.png 1520w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<ul>\n<li><code class=\"language-text\">SimpleMessageListnerContainer</code> 가 동작되는 방식은 아래 코드를 보면 알 수 있습니다.</li>\n<li>1번 : <code class=\"language-text\">AmazonSQS Client</code>를 통해 큐로 <code class=\"language-text\">Polling Request</code>를 전송하여 메시지를 응답 받습니다.</li>\n<li>2번 : 응답받은 메시지 수 만큼 <code class=\"language-text\">CountDownLatch</code> 객체를 생성합니다.</li>\n<li>\n<p>3번 : 응답받은 각 메시지를 For문으로 돌면서 할당받은 스레드풀에 작업을 등록합니다.</p>\n<ul>\n<li>스레드풀에 전달하는 <code class=\"language-text\">SignalExecutingRunnable</code>객체는 각 메시지가 처리되면 <code class=\"language-text\">CountDownLatch</code> 값을 Down 시킵니다.</li>\n</ul>\n</li>\n<li>5번 : <code class=\"language-text\">CountDownLatch</code> 가 0이 될때 까지 대기합니다.</li>\n</ul>\n<h3 id=\"낮은-처리량-문제\" style=\"position:relative;\">낮은 처리량 문제<a href=\"#%EB%82%AE%EC%9D%80-%EC%B2%98%EB%A6%AC%EB%9F%89-%EB%AC%B8%EC%A0%9C\" aria-label=\"낮은 처리량 문제 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p><code class=\"language-text\">SimpleMessageContainerListener</code> 의 구현에서의 문제점은 최대 10개 메시지를 수신하여 처리할 수 있고, 이 메시지 모두가 처리되면 다음 <code class=\"language-text\">Poilling</code> 을 시작합니다.  대부분의 스레드가 DB Blocking I/O 작업으로 인해 비효율적인 CPU 사용을 초래할 수 있고, 10개 메시지 중에 처리가 오래걸리는 메시지가 존재한다면 그 메시지가 처리될 때까지 다른  모든 스레드가 대기하게 되므로 Consumer의 처리량이 낮아지게 됩니다.</p>\n<h3 id=\"단일-Payload-Handling\" style=\"position:relative;\">단일 Payload Handling<a href=\"#%EB%8B%A8%EC%9D%BC-Payload-Handling\" aria-label=\"단일 Payload Handling permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\t<span class=\"token annotation punctuation\">@SqsListener</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"async_ff.fifo\"</span><span class=\"token punctuation\">,</span> deletionPolicy <span class=\"token operator\">=</span> <span class=\"token class-name\">SqsMessageDeletionPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NEVER</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle1</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Payload</span> <span class=\"token class-name\">ApplicationEventMessage</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"receieved Message {} \"</span> <span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token annotation punctuation\">@SqsListener</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"async_ff.fifo\"</span><span class=\"token punctuation\">,</span> deletionPolicy <span class=\"token operator\">=</span> <span class=\"token class-name\">SqsMessageDeletionPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NEVER</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle2</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Payload</span> <span class=\"token class-name\">Message</span> message<span class=\"token punctuation\">,</span> <span class=\"token class-name\">MessageHeaders</span> messageHeaders<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Acknowledgment</span> acknowledgment<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">{</span>\n\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"receieved Message {} \"</span> <span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">async_ff.fifo</code> 큐에 대해서 <code class=\"language-text\">@SqsListener</code>로 메시지를 구독합니다.</li>\n<li>첫번쨰 핸들러의 페이로드 타입은 <code class=\"language-text\">ApplicationEventMessage</code> 이고, 두번째 핸들러 페이로드 타입은 <code class=\"language-text\">Message</code>입니다.</li>\n<li>위 코드를 돌려보면 아래와 같이 async<em>ff</em>fifo 큐에 중복된 핸들러로 맵핑할 수 없는 예외가 발생합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Ambiguous handler methods mapped for destination 'async_ff.fifo': {public void com.example.awssqspilot.springboot.listener.SqsMessageListener.handle1(com.example.awssqspilot.domain.model.ApplicationEventMessage,org.springframework.messaging.MessageHeaders,org.springframework.cloud.aws.messaging.listener.Acknowledgment) throws java.lang.InterruptedException, public void com.example.awssqspilot.springboot.listener.SqsMessageListener.handle2(org.springframework.messaging.Message,org.springframework.messaging.MessageHeaders,org.springframework.cloud.aws.messaging.listener.Acknowledgment) throws java.lang.InterruptedException}</code></pre></div>\n<h1><strong>3. Solution</strong></h1>\n<h2 id=\"1-처리량-극복\" style=\"position:relative;\"><strong>1. 처리량 극복</strong><a href=\"#1-%EC%B2%98%EB%A6%AC%EB%9F%89-%EA%B7%B9%EB%B3%B5\" aria-label=\"1 처리량 극복 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1294f674f9fe2a3714d1db9df4a41a01/5ba40/Untitled_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA0UlEQVR42j2RBwqFMBBEvf8ZBSui2Ht3P29gf2DMmpnMlgTrutp931bXtYVhaFEUWZqmlue5TdNkx3HYeZ7SbNummD3LMum7rhO377sQ8EEAIEFRFBbHsY3jqHMugO/7BBYcRaBlR0dxMoS8rsvmeba+74WmaWROjAaxV/c8jy3LIq5t278Wn4DMvt73lZiLtEoSzjCrqkojIMaAqvgHFIIZcYBgGAYZQJCpLEtLkkTZncOcZIAi0MJhBDxWy5C0QhtkYfcYzmcI3NRn74/hM/wBt03Ng1b+PCwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/1294f674f9fe2a3714d1db9df4a41a01/ca1dc/Untitled_2.png\"\n        srcset=\"/static/1294f674f9fe2a3714d1db9df4a41a01/e7570/Untitled_2.png 170w,\n/static/1294f674f9fe2a3714d1db9df4a41a01/f46e7/Untitled_2.png 340w,\n/static/1294f674f9fe2a3714d1db9df4a41a01/ca1dc/Untitled_2.png 680w,\n/static/1294f674f9fe2a3714d1db9df4a41a01/02d09/Untitled_2.png 1020w,\n/static/1294f674f9fe2a3714d1db9df4a41a01/9d567/Untitled_2.png 1360w,\n/static/1294f674f9fe2a3714d1db9df4a41a01/5ba40/Untitled_2.png 2820w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<ul>\n<li>폴링 스레드에서 메시지를 처리하는 것이 아니라 <code class=\"language-text\">MessageHandler</code>로 메시지 처리를 위임합니다.</li>\n<li>폴링 스레드는 <code class=\"language-text\">MessageHandler</code> 에 작업만 전달하고 결과를 기다리지 않고, SQS Queue 로 다음 폴링 요청만 받습니다.</li>\n<li>MessageHandler는 <code class=\"language-text\">EventWorkThreadPool</code>을 구성하고, 비동기처리로 CPU burst time 을 높입니다.</li>\n</ul>\n<h2 id=\"2-단일-페이로드-극복\" style=\"position:relative;\"><strong>2. 단일 페이로드 극복</strong><a href=\"#2-%EB%8B%A8%EC%9D%BC-%ED%8E%98%EC%9D%B4%EB%A1%9C%EB%93%9C-%EA%B7%B9%EB%B3%B5\" aria-label=\"2 단일 페이로드 극복 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8ccfce1580be71f0c0672d2fcd7bd4f2/c6049/Untitled_3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.705882352941178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAoElEQVR42oWQyQrFIAxF/f+v7EqQImrp4NTmcQIp3b1AUHOHJDr5E3NOzfu+NWut0nt/6+TzPC/fQYJwXZe01mSMoUICIhhvsJSSLMsiOWfFMDP+cRxadxht2ybeeyWHEHQK6w5uHAxLKbLvu2LwMOKN2bqu4s7z1O6ciBBAijHqnQkwRGA4xogxtMmpo3G2+/cfCFvf/o+T9S2/dbQ27Q8+QIYKnCaZuwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/8ccfce1580be71f0c0672d2fcd7bd4f2/ca1dc/Untitled_3.png\"\n        srcset=\"/static/8ccfce1580be71f0c0672d2fcd7bd4f2/e7570/Untitled_3.png 170w,\n/static/8ccfce1580be71f0c0672d2fcd7bd4f2/f46e7/Untitled_3.png 340w,\n/static/8ccfce1580be71f0c0672d2fcd7bd4f2/ca1dc/Untitled_3.png 680w,\n/static/8ccfce1580be71f0c0672d2fcd7bd4f2/02d09/Untitled_3.png 1020w,\n/static/8ccfce1580be71f0c0672d2fcd7bd4f2/9d567/Untitled_3.png 1360w,\n/static/8ccfce1580be71f0c0672d2fcd7bd4f2/c6049/Untitled_3.png 2798w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<h1><strong>4. Implementation</strong></h1>\n<h2 id=\"1-EventWorkPool-설정\" style=\"position:relative;\"><strong>1. EventWorkPool 설정</strong><a href=\"#1-EventWorkPool-%EC%84%A4%EC%A0%95\" aria-label=\"1 EventWorkPool 설정 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"eventWorkerPool\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">ThreadPoolTaskExecutor</span> <span class=\"token function\">eventWorkerPool</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">ThreadPoolTaskExecutor</span> executor <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadPoolTaskExecutor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\texecutor<span class=\"token punctuation\">.</span><span class=\"token function\">setMaxPoolSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 스레드풀 개수를 설정합니다.</span>\n\texecutor<span class=\"token punctuation\">.</span><span class=\"token function\">setQueueCapacity</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 스레드풀 대기큐에 과도한 요청이 들어오는걸 방지하기 위해 대기큐 사이즈를 0으로 설정합니다.</span>\n\t<span class=\"token keyword\">return</span> executor<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"2-SqsMessageHandler-구현\" style=\"position:relative;\"><strong>2. SqsMessageHandler 구현</strong><a href=\"#2-SqsMessageHandler-%EA%B5%AC%ED%98%84\" aria-label=\"2 SqsMessageHandler 구현 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SqsMessageHandler</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AsyncTaskExecutor</span> eventWorkerPool<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageTypeDispatcher</span> messageTypeDispatcher<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> backOffTime <span class=\"token operator\">=</span> <span class=\"token number\">5000L</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">SqsMessage</span> message<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageHeaders</span> messageHeaders<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">Acknowledgment</span> acknowledgment\n\t<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\n\t\t\teventWorkerPool<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n\n\t\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">Object</span> result <span class=\"token operator\">=</span> messageTypeDispatcher<span class=\"token punctuation\">.</span><span class=\"token function\">doDispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">getMessageType</span><span class=\"token punctuation\">(</span>messageHeaders<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">getPayload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t\t\t\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"EventWorkerPool Exception occurred\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t\t<span class=\"token comment\">// noinspection BusyWait</span>\n\t\t\t\t\t\t<span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>backOffTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> ie<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t\t<span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">interrupt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t<span class=\"token punctuation\">}</span>\n\n\t\t\t\t\t<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\n\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">RejectedExecutionException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"eventThreadPool Queue is full. {}\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">MessageType</span> <span class=\"token function\">getMessageType</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageHeaders</span> messageHeaders<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MessageType</span><span class=\"token punctuation\">(</span>messageHeaders<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SqsMessageHeaders</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SQS_EVENT_TYPE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"3-MessageDispatcher-구현\" style=\"position:relative;\"><strong>3. MessageDispatcher 구현</strong><a href=\"#3-MessageDispatcher-%EA%B5%AC%ED%98%84\" aria-label=\"3 MessageDispatcher 구현 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2cf93942d77587adb10b1211c512a0b7/78873/Untitled_4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82.3529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/UlEQVR42n2TCW7bMBBFfZQWjSUuw+EyI4miLdV7nLq2UQQIev+TlJTTBGgTUw8fpKBPfc5Is4Ry7XBJzYZgxzAQDdwm76Pz0bqF970rEFql/x2zx3r+LL48qeoAeJT6p7InY6/El0CZk/NHdGe0P+Zz9epWZdzMrOXGh5G7tYO1Nz3oZHTCoj2oiTLxRgMCGDBo0XmDWMwKoGHfR7YBpbfKowqZMpEOlTUwqXGIWQ2g9zawtbaYHQBLQaLmuqaJUBVICJYSpoxZdb5yVnULLW/BZ1tRnc18mzNzu3JuFWjfdE992oYwVNWmqv6v03vB9qo+unl0wN3A3Pdxsdvst5td18bow2n+AHfMrRRXxpd19zzQSzIH1EMtxroepVgJaXPEO2YNQAR9h8xog1EGaq0zYuJO5mI2Bo2xMGlpA+ZCTpUFyIFBwz0zIlLTBmp8yNIQcyB2gXJXlJRvfGLOn4GXwbvsLd13wVgHeUtPgVtuO+K8Y2PggwizfG8kNYxjGtdx+X2x3qVx0w+rtNotl8txkZwP+SRmOsCNd7PUYJ0JwRpufRs5Jh+Ta1rbdI6CBiU01EqJj0o4Y6WSVJ0QUYiurl/JSymjVJleFW7L/CT9/SuK+VBVv/XXa0Mn7s6ef3G6ULw07Zn40bqjdScfjogHtHvrT8Y8P3x7e/MfIyyzgSiprs0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/2cf93942d77587adb10b1211c512a0b7/ca1dc/Untitled_4.png\"\n        srcset=\"/static/2cf93942d77587adb10b1211c512a0b7/e7570/Untitled_4.png 170w,\n/static/2cf93942d77587adb10b1211c512a0b7/f46e7/Untitled_4.png 340w,\n/static/2cf93942d77587adb10b1211c512a0b7/ca1dc/Untitled_4.png 680w,\n/static/2cf93942d77587adb10b1211c512a0b7/02d09/Untitled_4.png 1020w,\n/static/2cf93942d77587adb10b1211c512a0b7/9d567/Untitled_4.png 1360w,\n/static/2cf93942d77587adb10b1211c512a0b7/78873/Untitled_4.png 1520w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<ul>\n<li>JAVA Reflection 과 Spring Component 스캔을 이용해서 <code class=\"language-text\">dynamic dispatch</code>로 구현</li>\n<li><code class=\"language-text\">processor</code> 객체로 <code class=\"language-text\">messageType</code> 에 해당하는 <code class=\"language-text\">advice</code> 객체를 <code class=\"language-text\">get</code> 합니다.</li>\n<li>반환받은 advice 객체 정보를 이용해서 <code class=\"language-text\">target bean</code> 과 <code class=\"language-text\">method</code>를 가져옵니다.</li>\n<li><code class=\"language-text\">target method</code> 파라미터 타입에 맞게 ObjectMapper로 <code class=\"language-text\">json -> Object</code> 로 맵핑 후, <code class=\"language-text\">target method</code> 를 실행합니다.</li>\n</ul>\n<h2 id=\"4-사용\" style=\"position:relative;\">4. 사용<a href=\"#4-%EC%82%AC%EC%9A%A9\" aria-label=\"4 사용 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4956f16a180f5e9878b1d72ab5c901a3/78873/Untitled_5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.176470588235293%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnUlEQVR42m2MW47DIAxFs5npKDg4FINfkFYjzf7XVJPvXvmp6+PN5Xfqj8tjjuxTx/WnPljd5mV2mUzl0fvwxkq1POuzRlBURNxawSli2sVV3HgYdWosbNODn6/Oks9S8KiYbpgqtUq04FLoev37+y3GTbmaIgLGSRdRW2Q+IIVgT3cP7XskAGx5mUcIIB1rSmvJmPHE84z3sKzv+gBaGC6rZ28/QgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/4956f16a180f5e9878b1d72ab5c901a3/ca1dc/Untitled_5.png\"\n        srcset=\"/static/4956f16a180f5e9878b1d72ab5c901a3/e7570/Untitled_5.png 170w,\n/static/4956f16a180f5e9878b1d72ab5c901a3/f46e7/Untitled_5.png 340w,\n/static/4956f16a180f5e9878b1d72ab5c901a3/ca1dc/Untitled_5.png 680w,\n/static/4956f16a180f5e9878b1d72ab5c901a3/02d09/Untitled_5.png 1020w,\n/static/4956f16a180f5e9878b1d72ab5c901a3/9d567/Untitled_5.png 1360w,\n/static/4956f16a180f5e9878b1d72ab5c901a3/78873/Untitled_5.png 1520w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>","fields":{"slug":"/Spring Cloud AWS Messaging Module Best Practice/","thumbnail":null},"frontmatter":{"date":"June 20, 2023","update":"Jun 20, 2023","title":"Spring Cloud AWS Messaging 모듈 문제점 및 튜닝","description":null,"tags":["AWS"],"thumbnail":null}},{"excerpt":"대기열 유형 표준 대기열(Standard) 무제한 처리량 : API 작업당 거의 무제한의 TPS를 지원 최소한 한 번 전달(At-least-once delivery) : 메시가 최소한 한 번 전달되고, 가끔 2개 이상의 메시지 복사본이 전달될 수 있다. 순서 보장을 위해 최선의 노력 : 가끔 메시지가 전송된 순서와 다르게 전달될 수 있음.  FIFO 대기…","html":"<h2 id=\"대기열-유형\" style=\"position:relative;\">대기열 유형<a href=\"#%EB%8C%80%EA%B8%B0%EC%97%B4-%EC%9C%A0%ED%98%95\" aria-label=\"대기열 유형 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"표준-대기열Standard\" style=\"position:relative;\">표준 대기열(Standard)<a href=\"#%ED%91%9C%EC%A4%80-%EB%8C%80%EA%B8%B0%EC%97%B4Standard\" aria-label=\"표준 대기열Standard permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li><strong>무제한 처리량</strong> : API 작업당 거의 무제한의 TPS를 지원</li>\n<li><strong>최소한 한 번 전달(At-least-once delivery)</strong> : 메시가 최소한 한 번 전달되고, 가끔 2개 이상의 메시지 복사본이 전달될 수 있다.</li>\n<li><strong>순서 보장을 위해 최선의 노력</strong> : 가끔 메시지가 전송된 순서와 다르게 전달될 수 있음.</li>\n</ul>\n<!-- more -->\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 475px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ffb4bc851b55a5986bcbc4763f4e9ad3/abae4/Untitled.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.705882352941178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMUlEQVR42mNYtGgR96pVq3js7e1Z9u/fb3Ls2LEcIF+IAQgOHz5cAOTPBTKZli5dKlhYWMi5ZcsW+UOHDjnPnDmTf8qUKTwgDDIDhIFiXCB9DP///2cG0WfPno09derU/QsXLnCD+EB2PhAvBLHPnDnDCqJPnjwZdvr06XdAywShehkZkAHQVRxXrlwRunz5suzOnTu5J06cyH706FGxEydOOAFdyglSU19fzwI0eBXQtaFA9SzHjx/XA+kD0gogg+/evcsPNEMOKM+JYjjQALBLgS7wArroPdBQGZg4kD8HyA+AqQX6QuzcuXNfgLQvsl4GYBjIw/D06dMVgOEgN3/+fI3169fbzp07VwnEB8mlpaXxt7a2is+aNUsRqlYV6KN4oEHGvb290iC9U6dOlQUAWWOz9KLahKEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/ffb4bc851b55a5986bcbc4763f4e9ad3/abae4/Untitled.png\"\n        srcset=\"/static/ffb4bc851b55a5986bcbc4763f4e9ad3/e7570/Untitled.png 170w,\n/static/ffb4bc851b55a5986bcbc4763f4e9ad3/f46e7/Untitled.png 340w,\n/static/ffb4bc851b55a5986bcbc4763f4e9ad3/abae4/Untitled.png 475w\"\n        sizes=\"(max-width: 475px) 100vw, 475px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<h3 id=\"FIFO-대기열\" style=\"position:relative;\">FIFO 대기열<a href=\"#FIFO-%EB%8C%80%EA%B8%B0%EC%97%B4\" aria-label=\"FIFO 대기열 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li><strong>높은 처리량</strong>: 기본적으로 FIFO 대기열은 초당 최대 300개의 메시지(초당 300개의 전송, 수신 또는 삭제 작업)를 지원합니다. 작업당 최대 10개 메시지를 일괄 처리할 경우, FIFO 대기열은 초당 3000개의 메시지까지 지원할 수 있습니다.</li>\n<li><strong>정확히 한 번 처리(Exactly One Processing)</strong> : 메시지가 한 번 전달되고 소비자가 이를 처리 및 삭제할 때까지 유지됩니다. 중복 메시지는 대기열에 올라가지 않습니다.</li>\n<li><strong>선입선출 전달</strong>: 메시지가 전송되고 수신되는 순서가 엄격하게 지켜집니다.</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 475px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1c70de452e954228957d82589b13e7f2/abae4/Untitled_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 11.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAf0lEQVR42mM4duwY55kzZ/iPHz8uzgAEJ06cmAdkJx49elTn7NmzWzZs2MALlJ946tSpfCCWBbK379+/XwLILj19+nQ/SM/hw4cFgerFgOIcDOgGnjx5chkQpx46dEgPKLbvyJEjvED+DKBFJXv37pUH0geBQBKopwpo6DR0AwH3MF5JgTCH2AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/1c70de452e954228957d82589b13e7f2/abae4/Untitled_1.png\"\n        srcset=\"/static/1c70de452e954228957d82589b13e7f2/e7570/Untitled_1.png 170w,\n/static/1c70de452e954228957d82589b13e7f2/f46e7/Untitled_1.png 340w,\n/static/1c70de452e954228957d82589b13e7f2/abae4/Untitled_1.png 475w\"\n        sizes=\"(max-width: 475px) 100vw, 475px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<hr>\n<h2 id=\"FIFO-큐란-무엇인가\" style=\"position:relative;\">FIFO 큐란 무엇인가?<a href=\"#FIFO-%ED%81%90%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80\" aria-label=\"FIFO 큐란 무엇인가 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"일반적인-Queue\" style=\"position:relative;\">일반적인 Queue<a href=\"#%EC%9D%BC%EB%B0%98%EC%A0%81%EC%9D%B8-Queue\" aria-label=\"일반적인 Queue permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a576a3c6d14f3f9192afe21a4f5bac48/b986c/Untitled_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.58823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAf0lEQVR42o2PSQrFIBBEvf8xdSMO4ADO2p9q+FmEBFLgwtdVpS3WWpRzprvA386T0LH3JjHGIGstQwAEwGKMbOq9U2vtOqUUZucc9oNBxhiac5KotZL3ni+AzjkuCiFQSum1EDOtNXuRRQ5zgaBSik3/H35ZGV4UQXhESslb/QBF8zhbwyR+NgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/a576a3c6d14f3f9192afe21a4f5bac48/ca1dc/Untitled_2.png\"\n        srcset=\"/static/a576a3c6d14f3f9192afe21a4f5bac48/e7570/Untitled_2.png 170w,\n/static/a576a3c6d14f3f9192afe21a4f5bac48/f46e7/Untitled_2.png 340w,\n/static/a576a3c6d14f3f9192afe21a4f5bac48/ca1dc/Untitled_2.png 680w,\n/static/a576a3c6d14f3f9192afe21a4f5bac48/02d09/Untitled_2.png 1020w,\n/static/a576a3c6d14f3f9192afe21a4f5bac48/9d567/Untitled_2.png 1360w,\n/static/a576a3c6d14f3f9192afe21a4f5bac48/b986c/Untitled_2.png 1846w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<ul>\n<li>Queue에서 선입선출 방식으로 enqueue, dequeue할 수 있다.</li>\n</ul>\n<h3 id=\"멀티-스레드-환경에서의-문제점\" style=\"position:relative;\">멀티 스레드 환경에서의 문제점<a href=\"#%EB%A9%80%ED%8B%B0-%EC%8A%A4%EB%A0%88%EB%93%9C-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90\" aria-label=\"멀티 스레드 환경에서의 문제점 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b683c940773cbaab9f357e9f2401c0db/b88a2/Untitled_3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAwUlEQVR42p2Saw7DIAyDuf/9+MsZWqClTzJ9kUDZ1GldkayQNtgmwS3LIrVWOc+zx6dguWEYlGieZ9m2TY7jkH3fH0EJIWKhgFt+IGBd30V3yEGclVIkxqik5A3fHK3rqjcjUgepm6apE+CQnEgRAs2xdUstC3HvvaSUNFdCDtuBUEwcx1FCCJJzVpHWY8C+CZO/9RAVCHDUDtjhEC0B38hxb8k6IYV3m46o7dflULjalcMr4NBe/RN9KP88jV/P5gV34hNFoXmfBgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/b683c940773cbaab9f357e9f2401c0db/ca1dc/Untitled_3.png\"\n        srcset=\"/static/b683c940773cbaab9f357e9f2401c0db/e7570/Untitled_3.png 170w,\n/static/b683c940773cbaab9f357e9f2401c0db/f46e7/Untitled_3.png 340w,\n/static/b683c940773cbaab9f357e9f2401c0db/ca1dc/Untitled_3.png 680w,\n/static/b683c940773cbaab9f357e9f2401c0db/02d09/Untitled_3.png 1020w,\n/static/b683c940773cbaab9f357e9f2401c0db/9d567/Untitled_3.png 1360w,\n/static/b683c940773cbaab9f357e9f2401c0db/b88a2/Untitled_3.png 1844w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<ul>\n<li>\n<p>Producer와 Consumer가 다수(멀티스레드)인 환경에서는 FIFO(First In First Out)동작의 큐는 아무런 의미가 없다.</p>\n<ul>\n<li>Producer → Queue 에서의 네트워크 지연 시간</li>\n<li>Queue → Consumer 에서의 네트워크 지연 시간</li>\n<li>Consumer 에서 실제 메시지를 처리하는 시간</li>\n</ul>\n</li>\n<li>클라이언트가 원하는것은 메시지를 (1,2,3) 을 보내면 (1,2,3) 순서대로 처리하고 싶은 것</li>\n</ul>\n<h3 id=\"Producer--Queue-로의-순서보장\" style=\"position:relative;\">Producer → Queue 로의 순서보장<a href=\"#Producer--Queue-%EB%A1%9C%EC%9D%98-%EC%88%9C%EC%84%9C%EB%B3%B4%EC%9E%A5\" aria-label=\"Producer  Queue 로의 순서보장 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>Producer 에서 메시지를 전송할 때, Timestamp 를 찍어서 메시지를 전송한다.</li>\n<li>Queue 에서는 FIFO 큐가 아니라 Timestamp 기준의 우선순위 큐를 구성한다.</li>\n</ul>\n<h3 id=\"Queue--Consumer-로의-순서보장\" style=\"position:relative;\">Queue → Consumer 로의 순서보장<a href=\"#Queue--Consumer-%EB%A1%9C%EC%9D%98-%EC%88%9C%EC%84%9C%EB%B3%B4%EC%9E%A5\" aria-label=\"Queue  Consumer 로의 순서보장 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>가장 단순한 방법은 큐에서 Serializable하게 동기식으로 컨슈머에게 메시지를 전달하고 처리한다.</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/30926a1ac72255c48339811ef9232b0e/955c5/Untitled_4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA1ElEQVR42pWRuQ6EMAxE8/9fRwsFoqPhJtyHV8+SURZlix3JsmNP7GTsJMB1XWr3fcs/OI5D9n1X7wjWddUmdV1LmqZSFMXTHDvP8yvG4ONBlmWSJInkeS5umiaZ51knLMsiVVVJ13WaY6L3XmNqnOETW30cRz1j9HBMhfTGtm36IvOQAb8BNCSPD+GYMgyDHuz7eIhlWeoL4fR9rzU8dfLU7XfUHg3bto2KHS4IvewSIB9boIPItHBbbyOPRizNtIvx6OXQqGmaZxI+ZryGwablL94HtEhzQP0AvW4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/30926a1ac72255c48339811ef9232b0e/ca1dc/Untitled_4.png\"\n        srcset=\"/static/30926a1ac72255c48339811ef9232b0e/e7570/Untitled_4.png 170w,\n/static/30926a1ac72255c48339811ef9232b0e/f46e7/Untitled_4.png 340w,\n/static/30926a1ac72255c48339811ef9232b0e/ca1dc/Untitled_4.png 680w,\n/static/30926a1ac72255c48339811ef9232b0e/02d09/Untitled_4.png 1020w,\n/static/30926a1ac72255c48339811ef9232b0e/9d567/Untitled_4.png 1360w,\n/static/30926a1ac72255c48339811ef9232b0e/955c5/Untitled_4.png 1824w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<ul>\n<li>하지만, 이 방식의 문제점은 컨슈머가 다수더라도 단일 스레드 환경처럼 동작하여 처리량이 낮다.</li>\n</ul>\n<h3 id=\"SQS-FIFO-큐에서-해결한-방식\" style=\"position:relative;\">SQS FIFO 큐에서 해결한 방식<a href=\"#SQS-FIFO-%ED%81%90%EC%97%90%EC%84%9C-%ED%95%B4%EA%B2%B0%ED%95%9C-%EB%B0%A9%EC%8B%9D\" aria-label=\"SQS FIFO 큐에서 해결한 방식 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>SQS에서는 MessageGroup 이라는 개념을 적용하여 메시지를 논리적으로 하나의 그룹으로 묶는다.</li>\n<li>같은 그룹에 속하는 메시지는 앞에 메시지가 처리될 때까지 뒤에 들어온 메시지가 Blocking 되어 메시지 처리의 정확한 순서를 보장한다.</li>\n<li>같은 그룹이 아닌 메시지는 Blocking 되지 않으며, Consumer에게 큐잉된다.</li>\n<li>순서가 상관 없는 메시지는 서로 다른 그룹으로(A,B)로 지정한다.</li>\n<li>순서가 상관있는 메시지들끼리는 같은 그룹으로 지정한다.</li>\n</ul>\n<hr>\n<h2 id=\"분산-시스템에서-메시지-동기화-문제\" style=\"position:relative;\">분산 시스템에서 메시지 동기화 문제<a href=\"#%EB%B6%84%EC%82%B0-%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%97%90%EC%84%9C-%EB%A9%94%EC%8B%9C%EC%A7%80-%EB%8F%99%EA%B8%B0%ED%99%94-%EB%AC%B8%EC%A0%9C\" aria-label=\"분산 시스템에서 메시지 동기화 문제 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d7e92a3a0a6d3b5baac9bdcb43f80933/58a83/Untitled_5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+ElEQVR42nVR266DMAzj/z9sXzAmJp6QENNA4rJCaYHWq8NlbDonUtTGSh07jbz3MMbgN4gzhmFAkiQYx/EL/y+iZVmglJLCWivkx+kchkCUpim6rsM8z9Bay5BpmqRv7z0IWZRlCRceM1lTBXX45xO+aeDCfcUhwylCek7JARwYsdgbGLTmQs0wlwvc/b6qDzjVFEXxp9WqqlDXNaK+74Wdue7Tii1jRhR5LuQ7rhRtT+KEIvbzLChq23YjMNteDPJ8xO1mwt6IWcmmMbheNR4PG4gmZFmGOI5ln1R+EPLCSeffe70AOnPuYynMEiwY2n5fg2J+f/kNp1Ei5T+VrUEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/d7e92a3a0a6d3b5baac9bdcb43f80933/ca1dc/Untitled_5.png\"\n        srcset=\"/static/d7e92a3a0a6d3b5baac9bdcb43f80933/e7570/Untitled_5.png 170w,\n/static/d7e92a3a0a6d3b5baac9bdcb43f80933/f46e7/Untitled_5.png 340w,\n/static/d7e92a3a0a6d3b5baac9bdcb43f80933/ca1dc/Untitled_5.png 680w,\n/static/d7e92a3a0a6d3b5baac9bdcb43f80933/02d09/Untitled_5.png 1020w,\n/static/d7e92a3a0a6d3b5baac9bdcb43f80933/9d567/Untitled_5.png 1360w,\n/static/d7e92a3a0a6d3b5baac9bdcb43f80933/58a83/Untitled_5.png 1488w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<ul>\n<li>\n<p>시나리오</p>\n<ul>\n<li>Producer 가 Queue 메시지를 전송한다.</li>\n<li>큐는 수신된 메시지를 저장하고 확인응답(ack)를 Producer에게 응답한다.</li>\n<li>확인응답(ack)가 유실되어, Producer1는 메시지를 재전송한다.</li>\n<li>결과적으로 메시지 1이 중복되서 큐에 저장이 된다.</li>\n</ul>\n</li>\n<li>\n<p>Producer 에게 Ack 응답을 받으면 Message Commit하면 되지 않을까?</p>\n<ul>\n<li>\n<ol>\n<li>Producer → Queue 메시지 1 전달</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>Queue → Producer Ack 응답</li>\n</ol>\n</li>\n<li>\n<ol start=\"3\">\n<li>Producer → Queue Ack 응답</li>\n</ol>\n</li>\n<li>\n<ol start=\"4\">\n<li>Queue Message Commit</li>\n<li>\n<p>여기서 장애가 나면?</p>\n<ul>\n<li>Producer는 큐가 메시지를 정상적으로 받은 것으로 알고 있지만, 실제 Queue 에는 메시지가 정상적으로 저장되지 않았다. 즉 불일치가 발생한다.</li>\n<li>정확한 동기화를 위해서 무한대의 ack 가 필요하다.</li>\n</ul>\n</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"SQS가-메시지-처리를-하는-방법\" style=\"position:relative;\">SQS가 메시지 처리를 하는 방법<a href=\"#SQS%EA%B0%80-%EB%A9%94%EC%8B%9C%EC%A7%80-%EC%B2%98%EB%A6%AC%EB%A5%BC-%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"SQS가 메시지 처리를 하는 방법 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/818a3bf06bb7ada5f8784d526ca63fa1/9f622/Untitled_6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAABlElEQVR42pWT54pCQQyF7/s/lmDBgvWPXQQL9t71LF8gMrp62Q3k3plkcnKSyUTn81nr9VrT6VSbzUan00n3+10I6/l8bjqbzbTb7RTK8Xg0O7GcORwOivb7vZrNplKplLrdrhkdcLVaqVQqqVAoKJfLaTAYmN39i8XC7Mlk0s4AHj0eD6HX69UOkY3A0WhkDBF8nHkXt7kfjUL6AADUaDRMt9utqGC5XFr2fr+v8XisXq+ndrttyW+3m2ibgz8ByYIzZEJpKIlg3Wq1NJlMLAF7eh9W9wvQwZy+y+VyMaYwpsfsSe4xXwFh42AhKD5AOp2OXWCtVlO1WjXl5ik5luG7AEbZ9Jlg1HsO83CcnoCUgINRcaVHYWnfhIQfGdbrdVUqFSupXC6rWCwacBjwST72kDLcEbJhHY7FvxjGXUoc4EeGZIm7lD8z9IHm/84Eu/tgzzpshdv9j0Y8qXw+r3Q6/fJ+EV4Evmw2q0wmo+Fw+PKKeIKJRMKUSyQ24sP0MzLMVsiCUvD5rIXJYMgeu795Yn8A2A3aQBnEOhUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/818a3bf06bb7ada5f8784d526ca63fa1/ca1dc/Untitled_6.png\"\n        srcset=\"/static/818a3bf06bb7ada5f8784d526ca63fa1/e7570/Untitled_6.png 170w,\n/static/818a3bf06bb7ada5f8784d526ca63fa1/f46e7/Untitled_6.png 340w,\n/static/818a3bf06bb7ada5f8784d526ca63fa1/ca1dc/Untitled_6.png 680w,\n/static/818a3bf06bb7ada5f8784d526ca63fa1/02d09/Untitled_6.png 1020w,\n/static/818a3bf06bb7ada5f8784d526ca63fa1/9d567/Untitled_6.png 1360w,\n/static/818a3bf06bb7ada5f8784d526ca63fa1/9f622/Untitled_6.png 1376w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<ul>\n<li>Consumer 가 메시지를 수신하고 처리완료 후 큐에게 DeleteMessage 호출해야만 큐에서 메시지를 완전히 제거한다.</li>\n<li>하지만, 큐에 입장에서 Consumer가 메시지를 수신하고 정상적으로 처리해서 DeleteMessage를 호출한다는 보장이 없기 때문에, SQS는 메시지에 처리 시간 제한을 두었다.</li>\n<li>\n<p>이 시간 제한을 Visibility Timeout 이라고 하며, Consumer가 메시지를 수신 후 Visibility Timeout 시간 동안 Delete Message를 하지 않으면 자동으로 롤백된다.</p>\n<ul>\n<li>Consumer 가 메시지를 정상적으로 수신하면, SQS는 메시지를 바로 삭제하는 것이 아니라, 또 다른 Consumer가 해당 메시지를 수신하지 못하도록 막는다.</li>\n<li>Consumer 가 메시지를 수신하여, DeleteMessage 까지 한다면 큐에서 완전히 삭제한다.</li>\n<li>Consumer 가 Visibility Timeout 동안 DeleteMessage 하지 못한다면 메시지를 다른 컨슈머가 수신받을 수 있도록 원복시킨다.</li>\n</ul>\n</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cf7064483c5661a774f63fa6ea38da28/5745f/Untitled_7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.52941176470588%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAABh0lEQVR42s2U646CMBCFff9H2000ERPjNSpZL0EFFBVEneUbdxCxJv7cSUrLTHt6OnPahhR2u93ker1KdUxPq1r93xVr8Dmfz7JYLKTZbMpsNpPT6VROHI1G0m63xfM8jZldLhfp9XrS6XSk1WqJ7/sPQIKHw0HW67Ucj0cJw1Abvt1uJ3Ec63+SJE+MiNlcizWqtGHKcWHCztPpVLIsU2A2dRn+air+AO8OFsMQg+12uy397wDzPC/zXwImucgmKZgUtG0xbI0xizgS/UcMfzaJ+EFcMNo4K4kP8NVqpUXqdrvaG+ATwzCM5Pv7q8iZJ0EQvJVEmqbK3mRlIE6GTE7T7CXoAvywKI8E/19AbsdyuVQRuwwtmnirAE7ZGCDaQ/111jAj7tLiW4Y4ETUL70VKddzv9/WOj8djBa/H9/v9K0Pbgd3qzeKmt2oMfz3vpWy4v7weaNFuBBMnk4n6aeTYjHwOBgMZDod6iiiKnp8v8jefzzWHVWb4edrqBYMEPho3iKIB+AsCLS/nsOKKDgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/cf7064483c5661a774f63fa6ea38da28/ca1dc/Untitled_7.png\"\n        srcset=\"/static/cf7064483c5661a774f63fa6ea38da28/e7570/Untitled_7.png 170w,\n/static/cf7064483c5661a774f63fa6ea38da28/f46e7/Untitled_7.png 340w,\n/static/cf7064483c5661a774f63fa6ea38da28/ca1dc/Untitled_7.png 680w,\n/static/cf7064483c5661a774f63fa6ea38da28/02d09/Untitled_7.png 1020w,\n/static/cf7064483c5661a774f63fa6ea38da28/5745f/Untitled_7.png 1258w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<p><img src=\"https://docs.aws.amazon.com/images/AWSSimpleQueueService/latest/SQSDeveloperGuide/images/sqs-visibility-timeout-diagram.png\" alt=\"https://docs.aws.amazon.com/images/AWSSimpleQueueService/latest/SQSDeveloperGuide/images/sqs-visibility-timeout-diagram.png\"></p>\n<hr>\n<h2 id=\"At-least-once-delivery\" style=\"position:relative;\">At-least-once delivery<a href=\"#At-least-once-delivery\" aria-label=\"At least once delivery permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li>Standard 대기열의 경우 최소한 한 번 전달(At-least-once delivery)를 지원한다.</li>\n<li>\n<p>분산 시스템에서 메시지 동기화 문제 에서도 보았듯이 네트워크 문제로 아래와 같은 경우에 메시지가 두 번 이상 중복 발행될 수 있다.</p>\n<ul>\n<li>\n<p>Producer 가 Queue로 메시지를 전송했지만, Producer가 Ack 응답을 받지 못하여 메시지 전송실패로 알고 재전송 하는 경우</p>\n<ul>\n<li>→ 큐에 중복된 메시지가 저장되므로 같은 메시지가 두번 발행될 수 있다.</li>\n</ul>\n</li>\n<li>Consumer 가 메시지를 처리하고 DeleteMessage 를 호출하였지만, <strong>SQS 내부의 분산된 저장구조 특성 탓에 몇몇 메시지 복사본이 삭제되지 않고</strong> Consumer에게 재전송되는 경우</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Exactly-One-Processing\" style=\"position:relative;\">Exactly One Processing<a href=\"#Exactly-One-Processing\" aria-label=\"Exactly One Processing permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li>FIFO 대기열의 경우 정확히 한 번 처리(Exactly One Procession)을 지원한다.</li>\n<li>FIFO 대기열은 At-least-once delivery 에 엣지 케이스를 어떻게 해결했나?</li>\n</ul>\n<h3 id=\"Producer-가-Queue로-메시지를-전송했지만-Producer가-Ack-응답을-받지-못하여-메시지-전송실패로-알고-재전송-하는-경우\" style=\"position:relative;\">Producer 가 Queue로 메시지를 전송했지만, Producer가 Ack 응답을 받지 못하여 메시지 전송실패로 알고 재전송 하는 경우<a href=\"#Producer-%EA%B0%80-Queue%EB%A1%9C-%EB%A9%94%EC%8B%9C%EC%A7%80%EB%A5%BC-%EC%A0%84%EC%86%A1%ED%96%88%EC%A7%80%EB%A7%8C-Producer%EA%B0%80-Ack-%EC%9D%91%EB%8B%B5%EC%9D%84-%EB%B0%9B%EC%A7%80-%EB%AA%BB%ED%95%98%EC%97%AC-%EB%A9%94%EC%8B%9C%EC%A7%80-%EC%A0%84%EC%86%A1%EC%8B%A4%ED%8C%A8%EB%A1%9C-%EC%95%8C%EA%B3%A0-%EC%9E%AC%EC%A0%84%EC%86%A1-%ED%95%98%EB%8A%94-%EA%B2%BD%EC%9A%B0\" aria-label=\"Producer 가 Queue로 메시지를 전송했지만 Producer가 Ack 응답을 받지 못하여 메시지 전송실패로 알고 재전송 하는 경우 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>FIFO 대기열은 ContentBasedDeduplication 또는 MessageDeduplicationId 기반으로 메시지 중복 제거를 지원</li>\n<li>ContentBasedDeduplication 은 메시지 컨텐츠를 SHA-256 으로 해쉬</li>\n<li>MessageDeduplicationId 은 Producer 가 직접 지정하여 메시지를 전송한다.</li>\n<li>둘 중 하나의 방식으로 FIFO 대기열은 전송 중복 제거를 구현한다. 중복된 메시지의 경우 큐에 저장하지 않는다.</li>\n<li>중복값은 SQS에서 5분 동안 기억하고 있으며, 5분이 지나면 같은 메시지를 보낼 수 있다.</li>\n</ul>\n<h3 id=\"Consumer-가-메시지를-처리하고-DeleteMessage-를-호출하였지만-SQS-내부의-분산된-저장구조-특성-탓에-몇몇-메시지-복사본이-삭제되지-않고-Consumer에게-재전송되는-경우\" style=\"position:relative;\">Consumer 가 메시지를 처리하고 DeleteMessage 를 호출하였지만, SQS 내부의 분산된 저장구조 특성 탓에 몇몇 메시지 복사본이 삭제되지 않고 Consumer에게 재전송되는 경우<a href=\"#Consumer-%EA%B0%80-%EB%A9%94%EC%8B%9C%EC%A7%80%EB%A5%BC-%EC%B2%98%EB%A6%AC%ED%95%98%EA%B3%A0-DeleteMessage-%EB%A5%BC-%ED%98%B8%EC%B6%9C%ED%95%98%EC%98%80%EC%A7%80%EB%A7%8C-SQS-%EB%82%B4%EB%B6%80%EC%9D%98-%EB%B6%84%EC%82%B0%EB%90%9C-%EC%A0%80%EC%9E%A5%EA%B5%AC%EC%A1%B0-%ED%8A%B9%EC%84%B1-%ED%83%93%EC%97%90-%EB%AA%87%EB%AA%87-%EB%A9%94%EC%8B%9C%EC%A7%80-%EB%B3%B5%EC%82%AC%EB%B3%B8%EC%9D%B4-%EC%82%AD%EC%A0%9C%EB%90%98%EC%A7%80-%EC%95%8A%EA%B3%A0-Consumer%EC%97%90%EA%B2%8C-%EC%9E%AC%EC%A0%84%EC%86%A1%EB%90%98%EB%8A%94-%EA%B2%BD%EC%9A%B0\" aria-label=\"Consumer 가 메시지를 처리하고 DeleteMessage 를 호출하였지만 SQS 내부의 분산된 저장구조 특성 탓에 몇몇 메시지 복사본이 삭제되지 않고 Consumer에게 재전송되는 경우 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>정확한 방법에 대한 이야기는 없지만 해당 케이스는 표준 대기열에서만 발생하는 케이스라고 <a href=\"https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/standard-queues.html\">공식 문서</a>는 말한다.</li>\n</ul>\n<hr>\n<h2 id=\"Polling\" style=\"position:relative;\">Polling<a href=\"#Polling\" aria-label=\"Polling permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"Short-Polling-짧은-폴링\" style=\"position:relative;\">Short Polling (짧은 폴링)<a href=\"#Short-Polling-%EC%A7%A7%EC%9D%80-%ED%8F%B4%EB%A7%81\" aria-label=\"Short Polling 짧은 폴링 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/72df0ca5b1be444284fe56d530353f8e/5a4f3/Untitled_8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.88235294117648%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAABpElEQVR42p2U646CMBCFff8nU35pQkSjBFTiFY2Cd9HZfLMZg2zdxZ1khNL29JwzYxuPx0OyLNM8Ho9SjaIoJM9znb9er8J6i/v9Lvv9Xud4Eg0+jkYjCYJAZrPZD8Dz+SxxHMtwOJTT6SS32022261cLhd9j6JI+v2+jMfjb0B+OBUm74I5AFDQ6/Wk2WxKq9VSAhAC2MIJaLKQ4vu+HA4H2e12yhZQ5PFkDNifgBYAJUmiACQskY1FyAaIMcC1AMvm2zzPzWbzUsDaDE06G2ABYzz0PE89nE6nehjVfwvIuwEhsdPpyHK5VD8Z42Wapvpula7NkG/z+VzB8AomAE4mE2XL2OkhtMnVaiWDwUBl0Xss5DCrpssS0smQ00iTQjK2SppXNDJ9SDPz/eOiGDv+fsilmReLhbYTXtqhtQBZ2G63dbN5RsuQ6/X6uecjhrCi57AAloCTNDfNjmyT/q/GdkVthi5Aq2z5GnsBLFeYjS7Zv83bTQQoaxt2JXEfYnY1WByGoa6hMNXD6Ndut6v9C/iTIe3hkg0rQJmvMizvtdv8C95jy2ZRd4DVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/72df0ca5b1be444284fe56d530353f8e/ca1dc/Untitled_8.png\"\n        srcset=\"/static/72df0ca5b1be444284fe56d530353f8e/e7570/Untitled_8.png 170w,\n/static/72df0ca5b1be444284fe56d530353f8e/f46e7/Untitled_8.png 340w,\n/static/72df0ca5b1be444284fe56d530353f8e/ca1dc/Untitled_8.png 680w,\n/static/72df0ca5b1be444284fe56d530353f8e/02d09/Untitled_8.png 1020w,\n/static/72df0ca5b1be444284fe56d530353f8e/5a4f3/Untitled_8.png 1052w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<h3 id=\"Long-Poliing-긴-폴링\" style=\"position:relative;\">Long Poliing (긴 폴링)<a href=\"#Long-Poliing-%EA%B8%B4-%ED%8F%B4%EB%A7%81\" aria-label=\"Long Poliing 긴 폴링 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1e5183645c6599da98387356389c1b4c/cda85/Untitled_9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 142.94117647058823%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAYAAACqhkzFAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB0klEQVR42u2Wx47CQAyG8/7vhShHQBQhUOiil9CbV58lR5OQ1c6yHDispVFGY/sf90nQaDQkl8tJsViU6XQq2+1WNpuNLvaj0UhKpZKuyWQiu91Oz6Mokv1+L9VqVfL5vK7hcCjB6XRSJut2u0martergqCM7Gq1kkqlIq1WS88Oh4Py0Uc2QMmAHo9HvCCE1+u1CmIV+3a7LZ1OR+r1uu7P57PyTUcBL5dLfGDAEAqFQkGVsOJ+vz95gCyAxgvMLRfQCAuJJRcej8eEB64neOgFaISFBphFgCVc/jjAt7v8H8PfA7o1+BkxBIzWsxZlKg0GA7WMxYVegHaGApMFS2jFbrcr8/lcwZhAxvO20Jp/Npvp6GL2lctlHWUu/wkw3fSMKFyDjzIzj4GBVe6M9HYZwDAM9XbiaME3a+xyXE8AcgDoeDxWi/r9vg5ThLidZLhWeNUhrhBo4sQ7AiBAJMHc4ovMYrGQ5XIZl5L3gDW37N2wDPd6PZ3mgHIRsfVKigua9YC9XNgofPeQvdR6LqBXUtKv3p8B3TrKSspPgIkY8mjXarW42dN9TGabzaYWOGXj8vhSs/D5k6CMAhSYHnyzrESI2qT1iHWa0INPCfEr8gUaSuMM2vSiMQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/1e5183645c6599da98387356389c1b4c/ca1dc/Untitled_9.png\"\n        srcset=\"/static/1e5183645c6599da98387356389c1b4c/e7570/Untitled_9.png 170w,\n/static/1e5183645c6599da98387356389c1b4c/f46e7/Untitled_9.png 340w,\n/static/1e5183645c6599da98387356389c1b4c/ca1dc/Untitled_9.png 680w,\n/static/1e5183645c6599da98387356389c1b4c/cda85/Untitled_9.png 928w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<hr>\n<h2 id=\"FIFO-큐의-한계\" style=\"position:relative;\">FIFO 큐의 한계<a href=\"#FIFO-%ED%81%90%EC%9D%98-%ED%95%9C%EA%B3%84\" aria-label=\"FIFO 큐의 한계 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li>Producer의 부정확한 시계문제</li>\n<li>메시지 중복 5분 시간 제한 문제</li>\n<li>Visibility Timeout 엣지 케이스</li>\n</ul>\n<h2 id=\"참고자료\" style=\"position:relative;\">참고자료<a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li><a href=\"https://ably.com/blog/sqs-fifo-queues-message-ordering-and-exactly-once-processing-guaranteed\">SQS FIFO Queues: Message Ordering and Exactly-Once Processing Guaranteed? | Ably Blog: Data in Motion</a></li>\n<li><a href=\"https://awstip.com/how-to-efficiently-scale-aws-sqs-to-process-millions-of-messages-concurrently-in-spring-cloud-aws-c2431ed9e828\">https://awstip.com/how-to-efficiently-scale-aws-sqs-to-process-millions-of-messages-concurrently-in-spring-cloud-aws-c2431ed9e828</a></li>\n<li><a href=\"https://sookocheff.com/post/messaging/dissecting-sqs-fifo-queues/\">Dissecting SQS FIFO Queues — Does Ordered and Exactly Once Messaging Really Exist?</a> </li>\n<li><a href=\"https://tomgregory.com/3-surprising-facts-about-aws-sqs-fifo-queues/\">3 surprising facts about AWS SQS FIFO queues</a></li>\n<li><a href=\"https://aws.amazon.com/ko/blogs/developer/how-the-amazon-sqs-fifo-api-works/\">https://aws.amazon.com/ko/blogs/developer/how-the-amazon-sqs-fifo-api-works/</a></li>\n<li><a href=\"https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/welcome.html\">What is Amazon Simple Queue Service? - Amazon Simple Queue Service</a></li>\n</ul>","fields":{"slug":"/Amazon SQS Deep Dive/","thumbnail":null},"frontmatter":{"date":"June 19, 2023","update":"Jun 19, 2023","title":"Amazon SQS 딥다이브","description":null,"tags":["AWS"],"thumbnail":null}},{"excerpt":"카프카 스트림즈란? 사용자가 Kafka에서 데이터를 실시간으로 처리하는 상태 저장 스트림 처리 애플리케이션을 구축할 수 있게 해준다.\nStreams API로 개발된 애플리케이션은 이벤트 시간(즉, 데이터가 실제로 현실 세계에서 생성된 시점)을 기준으로 실시간 스트리밍 데이터를 처리하며, 늦게 도착하는 레코드도 지원한다.\n이를 통해 데이터 처리를 신속하게 …","html":"<h2 id=\"카프카-스트림즈란\" style=\"position:relative;\">카프카 스트림즈란?<a href=\"#%EC%B9%B4%ED%94%84%EC%B9%B4-%EC%8A%A4%ED%8A%B8%EB%A6%BC%EC%A6%88%EB%9E%80\" aria-label=\"카프카 스트림즈란 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>사용자가 Kafka에서 데이터를 실시간으로 처리하는 상태 저장 스트림 처리 애플리케이션을 구축할 수 있게 해준다.\nStreams API로 개발된 애플리케이션은 이벤트 시간(즉, 데이터가 실제로 현실 세계에서 생성된 시점)을 기준으로 실시간 스트리밍 데이터를 처리하며, 늦게 도착하는 레코드도 지원한다.\n이를 통해 데이터 처리를 신속하게 할 수 있으며, 탄력적으로 확장하고 분산 처리하며, 내결함성을 보장할 수 있다.</p>\n<!-- more -->\n<h2 id=\"스트림-처리에서-정확히-한-번이란-무엇인가\" style=\"position:relative;\">스트림 처리에서 정확히 한 번이란 무엇인가?<a href=\"#%EC%8A%A4%ED%8A%B8%EB%A6%BC-%EC%B2%98%EB%A6%AC%EC%97%90%EC%84%9C-%EC%A0%95%ED%99%95%ED%9E%88-%ED%95%9C-%EB%B2%88%EC%9D%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80\" aria-label=\"스트림 처리에서 정확히 한 번이란 무엇인가 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>스트림 처리 애플리케이션은 연속적인 데이터 스트림을 처리하므로,'정확성'을 보장하는 것은 중요한 문제이다.\n정확성을 보장하기 위해서는 입력 데이터 스트림의 각 레코드가 한 번만 처리되어야 한다는 조건이 항상 충족되어야한다.</p>\n<p>이를 구체적으로 설명하자면, 스트림 처리 애플리케이션은 카프카 토픽에서 읽어들인 레코드들을 처리하는데, 각 레코드는 한 번만 처리되어야 한다.\n이를 위해서 처리 로직은 읽기-처리-쓰기 패턴으로 구성되어야 한다.\n각 레코드는 읽혀지고, 처리 로직에 따라 상태가 업데이트되며, 그에 따라 출력 레코드가 생성될 수 있다.</p>\n<p>정확히 한 번이란, 입력 레코드의 처리 상태가 적절하게 업데이트되고, 출력 레코드가 정확히 한 번만 성공적으로 생성된 경우를 의미한다.\n즉, 각 레코드는 중복 처리되지 않아야 하며, 정확히 한 번의 결과만 생성되어야 한다.</p>\n<p>스트림 처리 애플리케이션이 단일 프로세스에서 실행되는 경우, 정확히 한 번을 유지하는 것은 상대적으로 쉽지만,\n여러 프로세스가 병렬로 실행되는 클러스터 환경에서 이 보장을 유지하는 것은 더 복잡하다.\n이러한 환경에서는 장애 상황이 발생할 가능성이 높아지기 때문에 정확히 한 번을 유지하는 것이 더 어려워진다.</p>\n<h2 id=\"Exactly-once의-어려움\" style=\"position:relative;\">Exactly once의 어려움<a href=\"#Exactly-once%EC%9D%98-%EC%96%B4%EB%A0%A4%EC%9B%80\" aria-label=\"Exactly once의 어려움 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>카프카에서 저장된 스트리밍 데이터로 읽기-처리-쓰기 스트림 처리 애플리케이션을 구축하는 일반적인 프로그래밍 패턴은 다음과 같다.</p>\n<ul>\n<li>입력 카프카 토픽에서 메시지 A를 가져온다 (예: 토픽 TA).</li>\n<li>가져온 메시지 A에 대해 처리 함수 F를 실행하여 해당 데이터를 처리하고, 처리 결과를 상태 S에서 S'로 업데이트한다.</li>\n<li>출력 메시지 B1부터 Bn까지 생성하여 출력 카프카 토픽으로 보낸다. (단일 토픽 TB로 가정하지만, 여러 토픽으로 쉽게 확장할 수 있다.)</li>\n<li>전송된 출력 메시지 B1부터 Bn이 카프카 브로커로부터 승인될 때까지 기다린다.</li>\n<li>처리된 메시지 A의 오프셋을 TA에 커밋하여 해당 메시지의 처리가 완료되었음을 나타내고, 커밋의 승인을 기다린다.\n<figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/28f5b4050ba190daaac019f8608f9062/5b89d/stream_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABY0lEQVR42p2Q207CQBCG++rGZ/CeC4yJGm80MREPmCCgiVGsqKBSChQwUnqg5bBL+7ktosaoF07y72F25tuZ0fxgwtbxDdmczt5hHrtvMJ7OcD2XuZgiZUQUg5zPEVISRRHqynQmcRyH4XCIbQ/p9S0cb4BmeyGrmSNWMqesZXe40nVuHts0nu4YvHTwPQ+71+dVqWM2VWKPptnipFCgfF6kVCpSLp9zlD/g2bxHi+OYyUwwUz8mezARqkJJo+fQMDt063UeSmXMik71osju/iaXlQuaVgt/NMIwDNrtNpZlqW4kGu8Wf1mXJ0e1Y1xXqCmgnjukVjijr6pMmk5b/wxf5CiHtjgsAIljGZMkBGGIq+bUqFZ5Vko+CIIwnecSsADHH9L4xZLHcDzGd11uD3I85E9ptbqMFHD+DvzJ/gSmFQ5sKusb3G5u89rtpj75L6CSECLV2B+lEkKm9/j78L4A3wADr17FYmIyHgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/28f5b4050ba190daaac019f8608f9062/ca1dc/stream_1.png\"\n        srcset=\"/static/28f5b4050ba190daaac019f8608f9062/e7570/stream_1.png 170w,\n/static/28f5b4050ba190daaac019f8608f9062/f46e7/stream_1.png 340w,\n/static/28f5b4050ba190daaac019f8608f9062/ca1dc/stream_1.png 680w,\n/static/28f5b4050ba190daaac019f8608f9062/02d09/stream_1.png 1020w,\n/static/28f5b4050ba190daaac019f8608f9062/9d567/stream_1.png 1360w,\n/static/28f5b4050ba190daaac019f8608f9062/5b89d/stream_1.png 1410w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></li>\n</ul>\n<p>실제로 4)와 5) 단계는 입력 Kafka 토픽에서 가져온 각 메시지에 대한 루프 반복 내에서 실행되지 않을 수 있다.\n이 단계들은 더 나은 성능을 위해 여러 메시지를 가져와서 처리한 후에만 호출된다.</p>\n<p>오류가 발생하지 않는다면, 이 구현 패턴은 각 레코드의 처리 결과(상태 업데이트와 출력 메시지)가 정확히 한 번만 반영되도록 보장할 수 있습니다.</p>\n<h2 id=\"실패-시나리오-1-중복-쓰기\" style=\"position:relative;\">실패 시나리오 #1: 중복 쓰기<a href=\"#%EC%8B%A4%ED%8C%A8-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-1-%EC%A4%91%EB%B3%B5-%EC%93%B0%EA%B8%B0\" aria-label=\"실패 시나리오 1 중복 쓰기 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>첫 번째 오류 시나리오는 4) 단계에서 발생한다.\n이 상황에서는 TB 파티션의 리더 복제본을 호스팅하는 Kafka 브로커와 스트림 처리 애플리케이션 간에 네트워크 파티션이 발생한다고 가정한다.\n이로 인해 메시지가 TB 파티션 로그에 성공적으로 추가된 후에도 브로커의 승인 응답이 전송되지 않아 애플리케이션은 응답을 기다리는 시간 초과를 경험하게 된다.</p>\n<p>이러한 상황에서 애플리케이션은 네트워크 파티션으로 인해 메시지가 성공적으로 추가되었는지 확인할 수 없기 때문에 일반적으로 메시지 전송을 다시 시도한다(예: Java 생산자 클라이언트를 사용하는 경우, 생산자의 \"재시도\" 구성을 설정하여 이를 수행할 수 있음).\n그러나 네트워크가 복구되면 재전송이 성공하더라도 동일한 출력 메시지가 출력 카프카 토픽에 여러 번 추가되어 \"중복 쓰기\"가 발생할 수 있다.</p>\n<h2 id=\"실패-시나리오-2-중복-처리\" style=\"position:relative;\">실패 시나리오 #2: 중복 처리<a href=\"#%EC%8B%A4%ED%8C%A8-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-2-%EC%A4%91%EB%B3%B5-%EC%B2%98%EB%A6%AC\" aria-label=\"실패 시나리오 2 중복 처리 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이제 5) 단계에서 메시지 A가 완전히 처리되어 애플리케이션 상태가 업데이트되고 출력 메시지가 성공적으로 전송되고 승인되었다고 해보자.\n그러나 애플리케이션이 메시지 A의 처리 위치를 커밋하기 전에 오류가 발생하여 충돌이 발생하였다.</p>\n<p>애플리케이션은 재시작할 때 실패한 지점에서 이전에 기억된 위치, 즉 커밋된 오프셋에서 처리를 다시 시작하려고 한다.\n그러나 애플리케이션이 이전에 처리된 메시지 A의 오프셋을 커밋하지 못했기 때문에 A를 다시 가져오게 된다.\n이렇게 되면 처리 로직이 다시 트리거되어 상태를 두 번 업데이트하고(예: S'에서 S''로) 출력 메시지도 두 번 생성된다.\n결과적으로 애플리케이션 상태가 두 번 업데이트되고 출력 메시지도 두 번 전송되어 토픽 TB에 중복으로 추가된다.\n예를 들어, 애플리케이션이 토픽 TA에 저장된 입력 데이터 스트림에서 실행 횟수를 계산하는 경우, 이 \"중복 처리\" 오류는 애플리케이션에서 잘못된 결과를 초래하는 초과 계산을 의미한다.</p>\n<p>현재 많은 스트림 처리 시스템들은 \"정확히 한 번만\" 의미론을 제공한다고 주장하지만,\n실제로는 사용자가 카프카와 같은 기본 소스 및 대상 스트리밍 데이터 저장 계층과 협력해야 한다.\n이 계층은 단순히 블랙박스로 취급되기 때문에 이러한 실패 사례를 처리하지 않기 때문이다.\n따라서 애플리케이션 사용자 코드는 2단계 커밋 메커니즘을 통해 이러한 데이터 시스템과 조율하여 데이터 중복을 방지하거나 위에서 언급한 장애 시나리오에서 생성될 수 있는 중복 레코드를 처리해야 한다.</p>\n<h2 id=\"Kafka-Streams가-정확한-1회-처리를-보장하는-방법\" style=\"position:relative;\">Kafka Streams가 정확한 1회 처리를 보장하는 방법<a href=\"#Kafka-Streams%EA%B0%80-%EC%A0%95%ED%99%95%ED%95%9C-1%ED%9A%8C-%EC%B2%98%EB%A6%AC%EB%A5%BC-%EB%B3%B4%EC%9E%A5%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"Kafka Streams가 정확한 1회 처리를 보장하는 방법 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>카프카를 중심으로 구축된 읽기-처리-쓰기 스트림 처리 애플리케이션은 입력 카프카 토픽에서 읽은 각 메시지 A에 대해 트리거되는 함수 F로 추상화할 수 있다. F는 세 가지 주요 단계로 구성된다.</p>\n<ul>\n<li>애플리케이션 상태를 S에서 S'로 업데이트한다.</li>\n<li>결과 메시지 B1, ... Bn을 출력 카프카 토픽 TB에 쓴다.</li>\n<li>입력 카프카 토픽 TA에 처리된 레코드 A의 오프셋을 커밋한다.\n이러한 세 단계가 원자적으로 실행되어 모두 실행되거나 실행되지 않도록 보장하는 것은 일반적으로 스트림 처리 기술에서 어려운 작업이다.\n그러나 카프카를 사용하면 이러한 어려움을 실제로 더 간단한 문제로 해결할 수 있다.</li>\n</ul>\n<p>먼저, 아파치 카프카에서는 오프셋 커밋을 기록하기 위해 내부 카프카 토픽(오프셋 토픽)에 메시지를 작성한다.\n따라서 소스 토픽에 대한 오프셋 커밋은 다른 메시지를 해당 카프카 토픽에 쓰는 것으로 직관적으로 이해할 수 있다.</p>\n<p>두 번째로, 카프카 스트림에서는 상태 업데이트를 변경 캡처 메시지로 변환할 수 있다.\nKafka Streams 라이브러리는 모든 상태 저장소의 업데이트를 변경 로그 토픽이라는 특수 카프카 토픽으로 캡쳐한다.\n각 저장소는 업데이트를 별도의 변경 로그 토픽에 보관하며, 해당 저장소에 업데이트가 적용될 때마다 변경 로그 토픽에 새로운 레코드로 전송된다.\n이렇게 함으로써 변경 로그 토픽은 로드 밸런싱이나 장애 복구 등에 활용되어 다른 프로세서의 상태 저장소 복제에 사용될 수 있다.\n이를 통해 스냅샷 S에서 S'로의 로컬 상태 저장소의 모든 업데이트는 Kafka 변경 로그에 저장된 상태 변경 메시지 시퀀스(S1, ... Sn)로 캡처된다.</p>\n<p>따라서 위의 세 단계를 모두 다른 주제로 전송된 여러 레코드로 변환할 수 있으며, 트랜잭션 API를 활용하여 출력 토픽, 변경 로그 토큽, 오프셋 토픽으로 원자 단위로 전송되도록 보장할 수 있다.\n이렇게 함으로써 카프카 스트림은 정확한 1회 처리를 보장할 수 있다.</p>\n<p>보다 구체적으로, processing.guarantee가 정확히_한번으로 구성된 경우, Kafka Streams는 내부 임베디드 생산자 클라이언트에 트랜잭션 ID를 설정하여 idempotence 및 트랜잭션 메시징 기능을 활성화하고,\n소비자 클라이언트를 읽기-커밋 모드로 설정하여 업스트림 생산자로부터 커밋된 트랜잭션의 메시지만 가져온다.</p>\n<p>애플리케이션을 시작하면 스트림 작업이 초기화되고 처리를 시작할 준비가 되면 임베디드 트랜잭션 생산자가 첫 번째 트랜잭션을 시작한다.\n그리고 애플리케이션이 현재 처리 상태를 커밋하려고 할 때마다 임베디드 트랜잭션 프로듀서를 사용해 소비자로부터 가져온 포지션 오프셋을 트랜잭션의 일부로 전송한 다음 현재 트랜잭션을 커밋하고 새 트랜잭션을 시작하려고 시도한다.</p>\n<p>이제 트랜잭션 내에서 일시적인 네트워크 분할이 발생하여 전송된 레코드 중 하나라도 제시간에 승인을 받지 못한 경우,\n동일한 트랜잭션 ID를 가진 스트림은 데이터를 다시 전송하려고 시도하는 경우가 있다.\n하지만, 프로듀서 구성 enable.idempotence가 true로 설정된 경우 브로커는 중복 메시지를 수신하면 해당 레코드를 무시하고 클라이언트에 DUP 응답을 반환한다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/10b87a3507b7046f81cead68138ef3dd/d880f/stream_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwklEQVR42mOwr69n8cidyOeRu5gvNGsKDwMM/P/PyIAAjFDMYG9vzxIaGiqXlZUlkZSUJBUQEKAWGOguGR1dJpOWNpOLwb54toNT+YJrTmXzbjqVzd9qWTRfw6x+G9//+v9MGzduFN+4Z4/42gsXxNZu3qy/eccO/YMnLihqhYayAc2WUNGQt6isLHXOySlxKaxMjMmodNVhMM6ZZG2dPTnQJmeSi2XOJG/jnJka5vkLNe1qlhn2z1plsKC+3mxadrbfnNJaxwn1hVFJWRFJMgoi9rrWQhbScvxOcnKKoerq2g4aWqqRMopCZgwM9fVMCJ+BvAnxqn39eoGO+h6bmWlp3hNj42OnRCeG9abEppYURkUlNNvKdqy1l7EIleEEKmUFYhYgZoOyYQYxMCKFFzAI/zOtmjNNfVppqW1baIRfe3h46Jy8Iufdq3bLrfr/nxlZLRKNG8ycOZN1zd698nPmzFGfXl0dPaup3mfT7t1y69evV0gDyjGQClatWsU2fdVm6d0LF/q82H/g/90dO54smzjRcM2WLfIzyTFw//79LJOXLZPavGKR/pGp06ccnj6zYenSpUoLVq2SrgcmNVwaAQsIpMK0uLKcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/10b87a3507b7046f81cead68138ef3dd/ca1dc/stream_2.png\"\n        srcset=\"/static/10b87a3507b7046f81cead68138ef3dd/e7570/stream_2.png 170w,\n/static/10b87a3507b7046f81cead68138ef3dd/f46e7/stream_2.png 340w,\n/static/10b87a3507b7046f81cead68138ef3dd/ca1dc/stream_2.png 680w,\n/static/10b87a3507b7046f81cead68138ef3dd/d880f/stream_2.png 975w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<p>또한, 정상 처리 중 또는 커밋 단계에서 치명적인 오류가 발생하면 Kafka Streams는 예외를 발생시키기 전에 생산자가 진행 중인 트랜잭션을 중단하도록 허용한다.\n이렇게 함으로써 스트림 애플리케이션 작업이 동일한 트랜잭션 ID로 다시 시작될 경우,\n이 ID의 마지막 트랜잭션이 완료(커밋 또는 중단)되었고 변경 로그 주제, 오프셋 주제 및 출력 주제에 커밋된 모든 메시지가 동일한 트랜잭션(아래 그림에 표시된 황금색 막대)에서 나온 것임을 확신할 수 있다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/90276009b1325d8122f92f1ac0765051/d880f/stream_3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9UlEQVR42mOor69nqre3Z1m+cKHmrg0bpBhA4P9/RgYo+M/AwPj//38mBgRgRGKDxJlCGRiYly5dKrh+/XoBBqfyhXvcS2ccD6uZstOuZrmmTOEqTpDKpVsuKW3ae6Hk7PKpUzasWr1m6t51QXv2bJaGGsRjaWmiU11dbZeXV2w6qaM2Z+G8WdPAFlvmTc9yzuuL9yrszbMomGlkWbxIRzlro8qylQsiL63J/nlvc/SvO2ti/h9cFHkxraTWUlKJxxqIbUQlhEJ1dXVDNTS0fbxc7bKSE2MyYZ5ihHsT5P16oDeKL3DP6uvLPZXo8PdmsNGnaymO/9dnxT32iY529ovW0vr/vx7kVTYg5gBikI/YGSBBwwg18D/jf3DY/GeEWbBg9lLjZfM2r1/XM/H82smz9yxYvmPqwR07ZJHDl2iQljaTdc2WLfIL1y3XnN7TnzC9tdX1yMPrUut3rJcFR2L9fpaKii2CjbUHTGtrTxh3VC+1mTtrms+qzfAwRgWrVq1iWwCU3DVvdtCT3Xv+39i0+VF38zSnlsZ57klJ03RCQ9tUSgo2WrfWHjvaVHPqcGfDpgtzZvYvwOvCmYvXSm6at9jo0JSpUw5OmVa7aNEqxf7p8xVAcqGhq5iL81YZZ6ctNirKWaqRlzrPNCd9iXVJ1ioJAHVv2tchmg0oAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/90276009b1325d8122f92f1ac0765051/ca1dc/stream_3.png\"\n        srcset=\"/static/90276009b1325d8122f92f1ac0765051/e7570/stream_3.png 170w,\n/static/90276009b1325d8122f92f1ac0765051/f46e7/stream_3.png 340w,\n/static/90276009b1325d8122f92f1ac0765051/ca1dc/stream_3.png 680w,\n/static/90276009b1325d8122f92f1ac0765051/d880f/stream_3.png 975w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<p>이 변경 로그 메시지 시퀀스를 재생하면 로컬 상태 저장소를 항상 S'까지 복원할 수 있다.\n따라서 프로세서 상태가 복원되고 작업이 처리를 재개할 준비가 되면 해당 상태는 커밋된 오프셋 및 출력 메시지와 일관된 스냅샷이 되므로 정확히 한 번만 의미론이 보장된다.</p>\n<h2 id=\"스트림-성능에-미치는-영향\" style=\"position:relative;\">스트림 성능에 미치는 영향<a href=\"#%EC%8A%A4%ED%8A%B8%EB%A6%BC-%EC%84%B1%EB%8A%A5%EC%97%90-%EB%AF%B8%EC%B9%98%EB%8A%94-%EC%98%81%ED%96%A5\" aria-label=\"스트림 성능에 미치는 영향 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>트랜잭션의 쓰기 증폭 비용은 일정하며 파티션 내에 쓰여진 메시지 수와 무관하다.\n따라서 메시지 측면에서 트랜잭션이 클수록 상각 비용은 작아진다.\n그러나 읽기 커밋 모드의 소비자는 트랜잭션이 커밋된 경우에만 트랜잭션의 메시지를 가져올 수 있기 때문에 트랜잭션이 클수록 엔드투엔드 처리 지연 시간도 길어진다.</p>\n<p>커밋이 호출될 때마다 새로운 트랜잭션이 생성되기 때문에, 평균 트랜잭션 크기는 커밋 간격에 의해 결정되며,\n동일한 수신 트래픽의 경우 커밋 간격이 짧을수록 트랜잭션이 더 작아진다.\n따라서 사용자는 정확히 한 번을 사용하도록 설정할 때 commit.interval.ms 설정을 조정하여 처리량과 엔드투엔드 처리 지연 시간 간에 적절한 균형을 맞춰야 한다.</p>\n<h2 id=\"참조\" style=\"position:relative;\">참조<a href=\"#%EC%B0%B8%EC%A1%B0\" aria-label=\"참조 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><a href=\"https://www.confluent.io/blog/enabling-exactly-once-kafka-streams/\">https://www.confluent.io/blog/enabling-exactly-once-kafka-streams/</a></p>","fields":{"slug":"/enabling_exactly_once_kafka_streams/","thumbnail":null},"frontmatter":{"date":"June 16, 2023","update":"Jun 16, 2023","title":"카프카 스트림즈의 정확히 한 번","description":null,"tags":["카프카"],"thumbnail":null}},{"excerpt":"왜 트랜잭션인가? 웹 페이지 노출 스트림을 소비하고 웹 페이지당 총 조회 수를 생성하는 애플리케이션은 카운트에서 약간의 오류를 허용할 수 있다.\n그러나 이러한 애플리케이션의 인기와 함께 더 강력한 의미론을 갖춘 스트림 처리 애플리케이션에 대한 수요도 증가했다.\n예를 들어, 일부 금융 기관에서는 스트림 처리 애플리케이션을 사용하여 사용자 계정의 차변 및 대…","html":"<h2 id=\"왜-트랜잭션인가\" style=\"position:relative;\">왜 트랜잭션인가?<a href=\"#%EC%99%9C-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%B8%EA%B0%80\" aria-label=\"왜 트랜잭션인가 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>웹 페이지 노출 스트림을 소비하고 웹 페이지당 총 조회 수를 생성하는 애플리케이션은 카운트에서 약간의 오류를 허용할 수 있다.\n그러나 이러한 애플리케이션의 인기와 함께 더 강력한 의미론을 갖춘 스트림 처리 애플리케이션에 대한 수요도 증가했다.\n예를 들어, 일부 금융 기관에서는 스트림 처리 애플리케이션을 사용하여 사용자 계정의 차변 및 대변을 처리한다.\n이러한 상황에서는 처리 오류에 대한 허용 오차가 없기 때문에 모든 메시지가 예외 없이 정확히 한 번만 처리되어야 한다.</p>\n<p>정확히 한 번만 처리한다는 것은 스트림 처리 애플리케이션이 메시지 A를 소비하고 메시지 B를 생성하여 B = F(A)가 되는 경우,\nB가 성공적으로 생성된 경우에만 A가 소비된 것으로 간주하고 그 반대의 경우도 마찬가지라는 뜻이다.</p>\n<p>하지만 바닐라 카프카 생산자와 소비자를 사용하여 스트림 처리 애플리케이션을 최소 1회 전송 의미론에 맞게 구성하면 정확히 1회 처리 의미론을 잃을 수 있다.\nproducer.send()는 내부 재시도로 인해 메시지 B에 대한 중복 쓰기를 초래할 수 있으며,\n입력 메시지 A를 재처리하여 출력에 중복된 B 메시지가 작성되어 정확히 한 번만 처리한다는 의미론을 위반할 수 있다.\n또한 분산 환경에서는 애플리케이션이 충돌하거나 더 심각한 경우 시스템의 나머지 부분과의 연결이 일시적으로 끊어져 새로운 인스턴스가 된다.\n이때 여러 인스턴스가 동일한 입력 주제를 처리하고 동일한 출력 주제에 쓰면서 중복 출력이 발생하고 정확히 한 번만 처리하는 시맨틱을 위반할 수 있다.\n이를 \"좀비 인스턴스\" 문제라고 부른다.</p>\n<h2 id=\"트랜잭션-의미론\" style=\"position:relative;\">트랜잭션 의미론<a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%9D%98%EB%AF%B8%EB%A1%A0\" aria-label=\"트랜잭션 의미론 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"Atomic-multi-partition-writes\" style=\"position:relative;\">Atomic multi-partition writes<a href=\"#Atomic-multi-partition-writes\" aria-label=\"Atomic multi partition writes permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>트랜잭션은 여러 개의 카프카 토픽과 파티션에 원자적 쓰기를 가능하게 한다.\n트랜잭션에 포함된 모든 메시지가 성공적으로 쓰여질 수도 있고 그렇지 않을 수도 있다.\n예를 들어, 처리 중 오류가 발생하면 트랜잭션이 중단될 수 있으며, 이 경우 소비자는 트랜잭션의 어떤 메시지도 읽을 수 없게 된다.</p>\n<p>원자적 읽기-처리-쓰기 주기가 활성화되는 방법을 살펴보자.\n이 주기는 애플리케이션이 토픽 파티션 tp0의 오프셋 X에서 메시지 A를 소비하고,\n메시지 A에 대해 처리를 수행한 후 메시지 B를 토픽 파티션 tp1에 쓰는 경우를 한다.\n이 주기는 메시지 A와 B가 함께 성공적으로 소비 및 게시된 것으로 간주되거나 전혀 그렇지 않은 경우에만 원자적이라고 한다.</p>\n<p>메시지 A는 오프셋 X가 소비된 것으로 표시된 경우에만 토픽 파티션 tp0에서 소비된 것으로 된다.\n이것을 오프셋 커밋이라고 하며, Kafka는 오프셋 커밋을 내부 Kafka 토픽에 기록한다.\n메시지는 오프셋이 오프셋 토픽에 커밋된 경우에만 소비된 것으로 간주된다.</p>\n<p>따라서 여러 토픽과 파티션에 걸친 원자적 쓰기는 오프셋 커밋을 통해 가능해진다.\n오프셋 X를 오프셋 토픽에 커밋하고 메시지 B를 tp1에 쓰는 것은 단일 트랜잭션의 일부가 되므로, 원자적으로 처리한다.</p>\n<h3 id=\"Zombie-fencing\" style=\"position:relative;\">Zombie fencing<a href=\"#Zombie-fencing\" aria-label=\"Zombie fencing permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>트랜잭션 생산자는 트랜잭션.id라는 고유 식별자를 할당받아야 한다.\n이 식별자는 프로듀서 인스턴스를 다시 시작할 때 동일한 프로듀서를 식별하는 데 사용된다.</p>\n<p>트랜잭션 API는 트랜잭션 생산자의 첫 번째 작업으로 트랜잭션.id를 Kafka 클러스터에 명시적으로 등록해야 한다고 요구한다.\n이렇게 함으로써 Kafka 브로커는 주어진 transactional.id로 열려 있는 트랜잭션을 확인하고 완료할 수 있다.\n또한 트랜잭션.id와 연결된 에포크를 시킨다. 에포크는 모든 트랜잭션.id에 대해 저장되는 내부 메타데이터이다.</p>\n<p>에포크가 증가하면 트랜잭션 id가 같고 에포크가 오래된 모든 프로듀서는 좀비로 간주되어 차단되며,\n해당 프로듀서의 향후 트랜잭션 쓰기가 거부된다. 이렇게 함으로써 좀비 인스턴스 문제를 해결할 수 있다.</p>\n<h3 id=\"트랜잭션-메시지-읽기\" style=\"position:relative;\">트랜잭션 메시지 읽기<a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%A9%94%EC%8B%9C%EC%A7%80-%EC%9D%BD%EA%B8%B0\" aria-label=\"트랜잭션 메시지 읽기 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>이제 트랜잭션 메시지를 읽을 때 제공되는 보장에 대해 알아보자.</p>\n<p>Kafka 소비자는 트랜잭션이 실제로 커밋된 경우에만 트랜잭션 메시지를 애플리케이션에 전달한다.\n다시 말해, 소비자는 진행 중인 트랜잭션의 일부인 트랜잭션 메시지를 전달하지 않으며 중단된 트랜잭션의 일부인 메시지도 전달하지 않는다.</p>\n<p>이러한 보장은 원자 읽기에는 미치지 못한다는 점에 유의할 필요가 있다.\n특히, 카프카 소비자를 사용하여 토픽의 메시지를 소비할 때, 애플리케이션은 이러한 메시지가 트랜잭션의 일부로 작성되었는지 여부를 알 수 없으므로 트랜잭션이 언제 시작되거나 종료되는지 알 수 없다.\n또한 특정 소비자가 트랜잭션의 일부인 모든 파티션에 가입되어 있다는 보장이 없으며, 이를 발견할 방법이 없기 때문에 단일 트랜잭션의 일부였던 모든 메시지가 결국 단일 소비자에게 소비될 것이라고 보장하기 어렵다.</p>\n<p>간단히 말해, 카프카는 소비자가 결국 커밋된 트랜잭션 메시지만 전달하도록 보장한다. 진행 중인 트랜잭션의 메시지는 보류하고 중단된 트랜잭션의 메시지는 필터링한다.</p>\n<h2 id=\"Java의-트랜잭션-API\" style=\"position:relative;\">Java의 트랜잭션 API<a href=\"#Java%EC%9D%98-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-API\" aria-label=\"Java의 트랜잭션 API permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>트랜잭션 기능은 서버 측 및 프로토콜 수준의 기능으로 주로 사용되며, Kafka의 트랜잭션 API는 이를 지원하는 모든 클라이언트 라이브러리에서 사용할 수 있다.\nJava로 작성된 '읽기-처리-쓰기' 애플리케이션에서 Kafka의 트랜잭션 API를 사용하는 형태는 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">KafkaProducer</span> producer <span class=\"token operator\">=</span> <span class=\"token function\">createKafkaProducer</span><span class=\"token punctuation\">(</span>\n  “bootstrap<span class=\"token punctuation\">.</span>servers”<span class=\"token punctuation\">,</span> “localhost<span class=\"token operator\">:</span><span class=\"token number\">9092</span>”<span class=\"token punctuation\">,</span>\n  “transactional<span class=\"token punctuation\">.</span>id”<span class=\"token punctuation\">,</span> “my<span class=\"token operator\">-</span>transactional<span class=\"token operator\">-</span>id”<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nproducer<span class=\"token punctuation\">.</span><span class=\"token function\">initTransactions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">KafkaConsumer</span> consumer <span class=\"token operator\">=</span> <span class=\"token function\">createKafkaConsumer</span><span class=\"token punctuation\">(</span>\n  “bootstrap<span class=\"token punctuation\">.</span>servers”<span class=\"token punctuation\">,</span> “localhost<span class=\"token operator\">:</span><span class=\"token number\">9092</span>”<span class=\"token punctuation\">,</span>\n  “group<span class=\"token punctuation\">.</span>id”<span class=\"token punctuation\">,</span> “my<span class=\"token operator\">-</span>group<span class=\"token operator\">-</span>id”<span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"isolation.level\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"read_committed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsumer<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token function\">singleton</span><span class=\"token punctuation\">(</span>“inputTopic”<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">ConsumerRecords</span> records <span class=\"token operator\">=</span> consumer<span class=\"token punctuation\">.</span><span class=\"token function\">poll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_VALUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  producer<span class=\"token punctuation\">.</span><span class=\"token function\">beginTransaction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ConsumerRecord</span> record <span class=\"token operator\">:</span> records<span class=\"token punctuation\">)</span>\n    producer<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token function\">producerRecord</span><span class=\"token punctuation\">(</span>“outputTopic”<span class=\"token punctuation\">,</span> record<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  producer<span class=\"token punctuation\">.</span><span class=\"token function\">sendOffsetsToTransaction</span><span class=\"token punctuation\">(</span><span class=\"token function\">currentOffsets</span><span class=\"token punctuation\">(</span>consumer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> group<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  producer<span class=\"token punctuation\">.</span><span class=\"token function\">commitTransaction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>1~5행은 구성을 지정하고 이를 initTransactions API에 등록하여 프로듀서를 설정한다.\nproducer.initTransactions()가 반환된 후, 동일한 transactional.id를 가진 다른 프로듀서 인스턴스로 시작된 모든 트랜잭션은 닫히고 펜싱된다.</p>\n<p>7-10행은 KafkaConsumer가 입력 토픽에서 비트랜잭션 메시지 또는 커밋된 트랜잭션 메시지만 읽어야 한다고 지정한다.\n스트림 처리 애플리케이션은 일반적으로 여러 읽기-처리-쓰기 단계로 데이터를 처리하며, 각 단계는 이전 단계의 출력을 입력으로 사용한다.\n읽기-커밋 모드를 지정하면 모든 단계에서 정확히 한 번만 처리할 수 있다.</p>\n<p>14~21행은 읽기-처리-쓰기 루프의 핵심을 보여준다. 일부 레코드를 소비하고, 트랜잭션을 시작하고, 소비된 레코드를 처리하고, 처리된 레코드를 출력 토픽에 쓰고, 소비된 오프셋을 오프셋 토픽으로 전송하고, 마지막으로 트랜잭션을 커밋하는 것이다.\n위에서 언급한 보증을 통해, 오프셋과 출력 레코드가 원자 단위로 커밋될 것임을 알 수 있다.</p>\n<h2 id=\"트랜잭션-작동-방식\" style=\"position:relative;\">트랜잭션 작동 방식<a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%9E%91%EB%8F%99-%EB%B0%A9%EC%8B%9D\" aria-label=\"트랜잭션 작동 방식 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/aabea023f072d0a2271d756434b6657f/5e6f0/img1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.11764705882354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlklEQVR42l2TW6+CQAyE+f9/yycfeNRECfECKoKICngF6349pxtCk80COzuddkogLu73u9xuN2maxq+2beVyucjj8ZBxfD4fuV6ves8W+LquJQDAw/f7la7r/CLe77c/g6Tvez0j0ev10h3isiw9qRKiiDifz7JcLmWxWCgYAsAAqYBLVVVJkiRKGIahTKdTmUwmslqtFO8VooYPKDE1lGvJUMkiSAA5Alin00lxvuTn86kvgI7Ho2RZpmSUw5kR2o5alHJGJVauL9kCEsBDorEZnA/PEEI1FoFlPhwOXjbZ2flmYS5CauQYtN/vVSHvcKlCFEVRpJd2u502nZ7OZjMlQbm5bUFS1nw+18Q2RoEdJmmqCsuikML1EEIcj+NYHR0bgxkk3m63OhWQkvhPoWts5ghrR1jhmiOFBIUkG5tihOv1WscFHKV7whojHKn9LciHMN1spB2MzZiwcInzPJfUiWE6vMvao/9fDgBASi7d89htI2RcUIdK+r9xybkTGAjHuExfMMYGfWjEMMDTN/CUiwjG5gdSx+o3XxXIwAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/aabea023f072d0a2271d756434b6657f/ca1dc/img1.png\"\n        srcset=\"/static/aabea023f072d0a2271d756434b6657f/e7570/img1.png 170w,\n/static/aabea023f072d0a2271d756434b6657f/f46e7/img1.png 340w,\n/static/aabea023f072d0a2271d756434b6657f/ca1dc/img1.png 680w,\n/static/aabea023f072d0a2271d756434b6657f/02d09/img1.png 1020w,\n/static/aabea023f072d0a2271d756434b6657f/5e6f0/img1.png 1334w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<h2 id=\"트랜잭션-코디네이터와-트랜잭션-로그\" style=\"position:relative;\">트랜잭션 코디네이터와 트랜잭션 로그<a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%BD%94%EB%94%94%EB%84%A4%EC%9D%B4%ED%84%B0%EC%99%80-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%A1%9C%EA%B7%B8\" aria-label=\"트랜잭션 코디네이터와 트랜잭션 로그 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Kafka 0.11.0에서 도입된 트랜잭션 API와 함께의 구성 요소는 다이어그램의 오른쪽에 위치한 트랜잭션 코디네이터와 트랜잭션 로그이다.</p>\n<p>트랜잭션 코디네이터는 모든 Kafka 브로커 내에서 실행되는 모듈로, 트랜잭션 처리를 조정한다.\n트랜잭션 로그는 카프카의 내부 토픽으로, 각 코디네이터는 트랜잭션 로그의 일부 파티션을 소유하게 된다.\n이때, 각 transactional.id는 간단한 해싱 함수를 통해 트랜잭션 로그의 특정 파티션에 매핑되어 정확히 하나의 코디네이터가 해당 트랜잭션 아이디를 소유하게 된다.</p>\n<p>이런 방식으로 Kafka의 견고한 복제 프로토콜과 리더 선출 프로세스를 활용하여 트랜잭션 코디네이터가 항상 사용 가능하고 모든 트랜잭션 상태가 내구성 있게 저장되도록 보장한다.</p>\n<p>트랜잭션 로그에는 트랜잭션의 최신 상태만 저장되며, 트랜잭션의 실제 메시지는 저장되지 않는다.\n메시지는 실제 토픽 파티션에만 저장되고, 트랜잭션은 여러 상태 중 \"진행 중\", \"커밋 준비 중\", \"완료됨\" 등의 상태에 있을 수 있다.\n트랜잭션 로그에는 이러한 상태와 관련된 메타데이터만 저장된다.</p>\n<h2 id=\"데이터-흐름\" style=\"position:relative;\">데이터 흐름<a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%9D%90%EB%A6%84\" aria-label=\"데이터 흐름 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>데이터 흐름은 크게 네 가지 유형으로 나눌 수 있다.</p>\n<p>A: 생산자와 트랜잭션 코디네이터의 상호작용으로 실행되는 트랜잭션 과정</p>\n<ul>\n<li>initTransactions API를 통해 생산자가 트랜잭션 코디네이터에게 트랜잭션 ID를 등록한다\n이때, 코디네이터는 해당 트랜잭션의 보류 중인 트랜잭션을 모두 종료하고 에포크를 업데이트하여 좀비를 차단한다. 이 작업은 프로듀서 세션당 한 번만 발생한다.</li>\n<li>프로듀서가 트랜잭션에서 처음으로 파티션에 데이터를 전송하려고 할 때, 해당 파티션이 코디네이터에 먼저 등록된다.</li>\n<li>애플리케이션이 commitTransaction 또는 abortTransaction을 호출하면 코디네이터에게 2단계 커밋 프로토콜을 시작하도록 요청한다.</li>\n</ul>\n<p>B: 코디네이터와 트랜잭션 로그가 상호작용하는 트랜잭션 과정에서, 프로듀서는 위의 요청을 통해 코디네이터의 트랜잭션 상태를 업데이트 한다.\n트랜잭션 코디네이터는 자신이 소유한 각 트랜잭션의 상태를 메모리에 보관하고, 트랜잭션 로그에 해당 상태를 기록한다(세 가지 방법으로 복제되므로 내구성이 있음).</p>\n<p>C: 대상 토픽 파티션에 데이터를 쓰는 프로듀서는 코디네이터와 트랜잭션에 새 파티션을 등록한 후, 정상적으로 실제 파티션에 데이터를 전송한다.\n이때, 몇 가지 추가 유효성 검사를 통해 생산자가 펜싱되지 않았는지 확인한다.</p>\n<p>D: 토픽-파티션 상호작용에 대한 코디네이터 프로듀서의 커밋(또는 중단)이 시작되면, 코디네이터는 2단계 커밋 프로토콜을 시작한다.</p>\n<p>첫 번째 단계에서 코디네이터는 내부 상태를 \"prepare_commit\"으로 업데이트하고 트랜잭션 로그에 이 상태를 업데이트한다.\n이 작업이 완료되면 트랜잭션은 무슨 일이 있어도 커밋이 보장된다.</p>\n<p>그런 다음 코디네이터는 트랜잭션의 일부인 토픽 파티션에 트랜잭션 커밋 마커를 기록하는 2단계를 시작한다.</p>\n<p>이러한 트랜잭션 마커는 애플리케이션에 노출되지는 않지만, 읽기_커밋 모드의 소비자가 중단된 트랜잭션에서 메시지를 필터링하고 열려 있는 트랜잭션의 일부인 메시지(즉, 로그에는 있지만 트랜잭션 마커가 연결되어 있지 않은 메시지)를 반환하지 않기 위해 사용된다.</p>\n<p>마커가 작성되면 트랜잭션 코디네이터가 트랜잭션을 \"완료\"로 표시하고 생산자는 다음 트랜잭션을 시작할 수 있다.</p>\n<h2 id=\"실제-트랜잭션\" style=\"position:relative;\">실제 트랜잭션<a href=\"#%EC%8B%A4%EC%A0%9C-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98\" aria-label=\"실제 트랜잭션 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이제 트랜잭션의 의미와 작동 방식을 이해했으므로 트랜잭션을 활용하는 애플리케이션 작성의 실제 측면에 주목해보자.</p>\n<p>트랜잭션 ID를 선택하는 방법은 좀비를 차단하는 데 중요한 역할을 한다.\n그러나 프로듀서 세션 전반에서 일관성을 유지하면서 좀비를 적절히 차단하는 식별자를 유지하는 것은 약간 까다로운 작업이다.</p>\n<p>좀비를 적절히 차단하기 위한 핵심은 읽기-프로세스-쓰기 주기의 입력 토픽과 파티션이 주어진 트랜잭션 ID에 대해 항상 동일한지 확인하는 것이다.\n그렇지 않으면 일부 메시지가 트랜잭션에서 제공하는 펜싱을 통해 유출될 수 있다.</p>\n<p>예를 들어, 분산 스트림 처리 애플리케이션에서 토픽 파티션 tp0이 원래 트랜잭션 ID T0에 의해 처리되었다고 가정해보자.\n나중에 어느 시점에 트랜잭션이 다른 생산자에게 매핑될 수 있다면, T0과 T1 사이에는 펜싱이 존재하지 않게 된다.\n따라서 tp0의 메시지가 재처리되어 정확히 한 번만 처리한다는 보장을 위반할 수 있다.</p>\n<p>실제로는 입력 파티션과 트랜잭션 ID 사이의 매핑을 외부 저장소에 저장하거나 정적 인코딩을 해야한다.\nKafka Streams는 이 문제를 해결하기 위해 후자의 접근 방식을 선택한다.</p>\n<h2 id=\"트랜잭션의-성능-및-조정-방법\" style=\"position:relative;\">트랜잭션의 성능 및 조정 방법<a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%98-%EC%84%B1%EB%8A%A5-%EB%B0%8F-%EC%A1%B0%EC%A0%95-%EB%B0%A9%EB%B2%95\" aria-label=\"트랜잭션의 성능 및 조정 방법 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>트랜잭션은 적당한 수준의 쓰기 증폭만 유발한다. 추가 쓰기는 다음과 같은 이유 때문이다.</p>\n<ul>\n<li>각 트랜잭션마다 코디네이터에 파티션을 등록하기 위한 추가 RPC가 필요하다. 이는 일괄 처리되므로 트랜잭션의 파티션 수보다 RPC 수가 적다.</li>\n<li>트랜잭션을 완료할 때, 트랜잭션에 참여하는 각 파티션에 하나의 트랜잭션 마커를 기록해야 한다.\n트랜잭션 코디네이터는 동일한 브로커에 바인딩된 모든 마커를 단일 RPC에서 일괄 처리하므로 RPC 오버헤드를 절약할 수 있지만, 트랜잭션의 각 파티션에 대한 추가 쓰기를 피할 수는 없다.</li>\n<li>마지막으로 트랜잭션 로그에 상태 변경 사항을 기록합니다.\n여기에는 트랜잭션에 추가된 각 파티션 배치에 대한 쓰기, \"prepare<em>commit\" 상태, \"complete</em>commit\" 상태가 포함된다.\n오버헤드는 트랜잭션의 일부로 기록되는 메시지 수와는 무관하다. 따라서 처리량을 높이려면 트랜잭션당 더 많은 수의 메시지를 포함시키는 것이 핵심이다.\n실제로 최대 처리량으로 1KB 레코드를 생성하는 프로듀서의 경우, 100ms마다 메시지를 커밋하면 처리량이 3%만 저하된다.\n더 작은 메시지나 더 짧은 트랜잭션 커밋 간격은 더 심각한 성능 저하를 초래할 수 있다.</li>\n</ul>\n<p>트랜잭션 기간을 늘릴 때의 주요 단점은 엔드 투 엔드 지연 시간이 증가한다는 것이다.\n트랜잭션 메시지를 읽는 소비자는 진행 중인 트랜잭션의 일부인 메시지를 전달하지 않는다는 것을 유의하자.\n따라서 커밋 사이의 간격이 길어질수록 소비 애플리케이션이 더 오래 기다려야 하므로 엔드투엔드 지연 시간이 증가한다.</p>\n<h2 id=\"트랜잭션-소비자의-성능\" style=\"position:relative;\">트랜잭션 소비자의 성능<a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%86%8C%EB%B9%84%EC%9E%90%EC%9D%98-%EC%84%B1%EB%8A%A5\" aria-label=\"트랜잭션 소비자의 성능 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>트랜잭션 소비자는 생산자보다 훨씬 간단하다.</p>\n<ul>\n<li>중단된 트랜잭션에 속한 메시지를 필터링한다.</li>\n<li>진행 중인 트랜잭션의 일부인 트랜잭션 메시지를 반환하지 않는다.</li>\n</ul>\n<p>따라서 트랜잭션 소비자는 read_committed 모드에서 트랜잭션 메시지를 읽을 때 처리량 저하가 나타나지 않는다.\n이 주된 이유는 트랜잭션 메시지를 읽을 때 제로 카피 읽기를 보존하기 때문이다.</p>\n<p>또한, 소비자는 트랜잭션이 완료될 때까지 기다리기 위해 버퍼링을 할 필요가 없다.\n대신 브로커는 미체결 트랜잭션이 포함된 오프셋으로 진행하는 것을 허용하지 않는다.</p>\n<h2 id=\"결론\" style=\"position:relative;\">결론<a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>읽기-처리-쓰기 주기를 고려할 때, 이 게시물에서는 주로 읽기 및 쓰기 경로를 다루었으며 처리 자체는 블랙박스에 해당된다.\n사실 처리 단계에서 수행할 수 있는 작업은 매우 많기 때문에 트랜잭션 API만으로는 정확한 1회 처리를 보장할 수 없다.\n예를 들어, 처리가 다른 스토리지 시스템에 부작용을 일으키는 경우, 여기서 다루는 API로는 정확한 1회 처리를 보장하기에 충분하지 않다.</p>\n<h2 id=\"참조\" style=\"position:relative;\">참조<a href=\"#%EC%B0%B8%EC%A1%B0\" aria-label=\"참조 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><a href=\"https://www.confluent.io/blog/transactions-apache-kafka/\">https://www.confluent.io/blog/transactions-apache-kafka/</a></p>","fields":{"slug":"/trasaction_in_kafka/","thumbnail":null},"frontmatter":{"date":"June 15, 2023","update":"Jun 15, 2023","title":"카프카에서의 Transactions","description":null,"tags":["카프카"],"thumbnail":null}},{"excerpt":"Message Delivery Semantics 분산형 Pub/Sub 메시징 시스템에서는 컴퓨터들이 독립적으로 장애를 일으킬 수 있다.\n예를 들어, 카프카는 개별 브로커 충돌이나 프로듀서가 메시지를 보내는 동안 네트워크 장애로 인해 문제가 발생할 수 있다.\n이러한 장애를 처리하기 위해 프로듀서가 취하는 조치에 따라 다른 의미가 있다. At most onc…","html":"<h2 id=\"Message-Delivery-Semantics\" style=\"position:relative;\">Message Delivery Semantics<a href=\"#Message-Delivery-Semantics\" aria-label=\"Message Delivery Semantics permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>분산형 Pub/Sub 메시징 시스템에서는 컴퓨터들이 독립적으로 장애를 일으킬 수 있다.\n예를 들어, 카프카는 개별 브로커 충돌이나 프로듀서가 메시지를 보내는 동안 네트워크 장애로 인해 문제가 발생할 수 있다.\n이러한 장애를 처리하기 위해 프로듀서가 취하는 조치에 따라 다른 의미가 있다.</p>\n<ul>\n<li>At most once: 생산자가 Kafka 브로커로부터 확인(ack)을 수신하고 acks=all인 경우, 이는 메시지가 Kafka 토픽에 정확히 한 번 쓰여진 것을 의미한다.\n그러나 프로듀서가 시간 초과되거나 오류를 수신하면 메시지가 카프카 토픽에 쓰여지지 않았다고 가정하고 메시지 전송을 다시 시도할 수 있다.\n이로 인해 브로커가 응답을 보내기 직전에 실패했을 경우, 메시지가 이미 성공적으로 쓰여졌음에도 불구하고 메시지가 두 번 쓰여져서 최종 소비자에게 중복 전달될 수 있다. </li>\n<li>At least once: 생산자가 시간 초과나 오류를 반환할 때 재시도하지 않으면 메시지가 카프카 토픽에 기록되지 않아 소비자에게 전달되지 않을 수 있다.\n대부분의 경우 메시지는 전달되지만, 때때로 중복 전달을 피하기 위해 일부 메시지는 전달되지 않을 수도 있다.</li>\n<li>\n<p>Exactly once: 이 경우 생산자가 메시지 전송을 다시 시도하더라도 최종적으로 메시지는 소비자에게 정확히 한 번만 전달된다.\n이 접근 방식은 가장 바람직한 방법이지만 이해하기 어렵다. 이는 메시징 시스템과 애플리케이션 간의 협력이 필요하기 때문이다.\n예를 들어, 메시지를 소비한 후에 카프카 소비자를 이전 오프셋으로 되돌리면 해당 오프셋에서 최신 메시지까지 모든 메시지를 다시 수신하게 된다.\n이렇게 하면 메시징 시스템과 클라이언트 애플리케이션이 협력하여 정확히 한 번만 메시지가 발생하도록 보장해야 한다.</p>\n<!-- more -->\n</li>\n</ul>\n<h2 id=\"Exactly-once-의-어려움\" style=\"position:relative;\">Exactly once 의 어려움<a href=\"#Exactly-once-%EC%9D%98-%EC%96%B4%EB%A0%A4%EC%9B%80\" aria-label=\"Exactly once 의 어려움 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>한 개의 프로세스로 동작하는 생산자 소프트웨어 애플리케이션이 'Hello Kafka'라는 단일 파티션 카프카 토픽에 'EoS'라는 메시지를 보낸다.\n이 메시지를 수신하기 위해 반대편에 위치한 단일 인스턴스 소비자 애플리케이션이 동작한다.\n이상적인 경우에는 잘 작동하여 'Hello Kafka' 메시지가 EoS 토픽 파티션에 한 번만 기록된다.\n소비자는 메시지를 가져와서 처리를 완료한 후 메시지 오프셋을 커밋하여 처리를 완료했음을 알린다.\n또한, 소비자 애플리케이션이 실패하고 다시 시작해도 같은 메시지를 중복 수신하지 않는다.</p>\n<p>그러나 현실적으로 예상치 못한 실패 시나리오가 항상 발생할 수 있다.</p>\n<ul>\n<li>브로커는 실패: Kafka는 고가용성, 지속성, 내구성이 뛰어난 시스템으로, 파티션에 기록된 모든 메시지는 일정 횟수 동안 지속 및 복제된다.\n이로 인해 Kafka는 n-1 브로커 장애를 견딜 수 있으며, 적어도 하나 이상의 사용 가능한 브로커가 있으면 파티션을 사용할 수 있다.\n카프카의 복제 프로토콜은 메시지가 리더 복제본에 성공적으로 쓰여질 경우 사용 가능한 모든 복제본에 복제되도록 보장한다.</li>\n<li>생산자-브로커 간 RPC는 실패: Kafka의 내구성은 브로커로부터 응답을 받는 프로듀서에 따라 달라진다.\n응답을 받지 못했다고 해서 요청 자체가 실패한 것은 아니다.\n브로커는 메시지를 작성한 후 생산자에게 응답을 보내기 전에 충돌할 수 있다.\n또한 토픽에 메시지를 작성하기 전에 크래시될 수도 있다.\n생산자는 실패의 원인을 알 수 없기 때문에 메시지가 성공적으로 작성되지 않았다고 가정하고 재시도할 수 있다.\n때로는 동일한 메시지가 카프카 파티션 로그에 중복되어 최종 소비자가 두 번 이상 수신하는 경우가 생길 수 있다.</li>\n<li>클라이언트가 실패: 한 번만 메시지를 전송하려면 클라이언트 장애도 고려해야 된다.\n그러나 클라이언트가 브로커에서 일시적으로 파티셔닝되거나 애플리케이션이 일시 중지된 것인지, 아니면 실제로 실패한 것인지를 어떻게 알 수 있을까?\n영구적인 장애와 일시적인 장애를 구분하는 것이 중요하며, 브로커는 '좀비' 생산자가 보낸 메시지를 삭제해야 한다.\n새로운 클라이언트 인스턴스가 시작될 때 실패한 인스턴스가 남긴 상태로부터 복구하여 안전한 지점부터 처리를 시작할 수 있어야 한다.\n즉, 소비된 오프셋은 항상 생산된 출력과 동기화 상태를 유지해야 한다.</li>\n</ul>\n<h3 id=\"멱등성-파티션당-Exactly-once-의미론\" style=\"position:relative;\">멱등성: 파티션당 Exactly once 의미론<a href=\"#%EB%A9%B1%EB%93%B1%EC%84%B1-%ED%8C%8C%ED%8B%B0%EC%85%98%EB%8B%B9-Exactly-once-%EC%9D%98%EB%AF%B8%EB%A1%A0\" aria-label=\"멱등성 파티션당 Exactly once 의미론 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>\"enable.idempotence=true\" 옵션을 사용하면, 비동작 연산을 여러 번 수행해도 동일한 결과를 보장한다.</li>\n<li>프로듀서 보내기 연산이 비활성화되어도, 오류로 인해 생산자가 메시지를 재시도하는 경우에도 브로커의 Kafka 로그에는 동일한 메시지가 한 번만 기록된다.</li>\n<li>단일 파티션의 경우, 멱등한 프로듀서가 메시지를 보내면 프로듀서나 브로커 오류로 인해 메시지가 중복되는 가능성이 없어진다.</li>\n<li>이 기능을 사용하여 파티션당 정확히 한 번만 시맨틱을 전송하므로 중복과 데이터 손실 없이 메시지를 순서대로 전송할 수 있다.     </li>\n</ul>\n<p>이 기능은 TCP와 유사한 방식으로 작동하며, Kafka로 전송되는 각 메시지 배치에는 중복 전송을 제거하는 데 사용되는 시퀀스 번호가 포함된다.\n이 시퀀스 번호는 복제된 로그에 유지되어 리더가 실패해도 인계받은 모든 브로커가 재전송이 중복 전송인지 여부를 파악할 수 있다.\n이 메커니즘은은 각 메시지 배치에 숫자 필드 몇 개만 추가하면 되기 때문에 성능 오버헤드가 매우 낮다.</p>\n<blockquote>\n<p>각 새로운 생산자는 초기화 과정에서 고유한 PID가 할당된다. PID 할당은 사용자에게 완전히 투명하며, 클라이언트에서 노출되지 않는다.\n특정 PID에 대해 시퀀스 번호는 0부터 시작하여 Topic Partition당 하나씩 모노토닉하게 증가된다.   </p>\n<p>생산자가 보내는 각 메시지마다 시퀀스 번호가 증가한다. 마찬가지로, 브로커는 해당 Topic Partition에 대해 커밋하는 각 메시지마다 PID -> Topic Partition 쌍에 연결된 시퀀스 번호를 증가시킨다.\n마지막으로, 브로커는 PID -> 토픽 파티션 쌍에서 마지막으로 커밋된 메시지보다 시퀀스 번호가 정확히 하나 크지 않은 경우 프로듀서로부터의 메시지를 거부한다.   </p>\n<p>이를 통해 생산자가 실패 시 요청을 다시 시도해야 할 수 있지만, 모든 메시지가 로그에 정확히 한 번만 지속되도록 보장된다.\n또한, 각 새로운 생산자 인스턴스에는 새로운 고유한 PID가 할당되므로 한 번의 생산 세션 내에서만 멱등한 생산을 보장할 수 있다.</p>\n</blockquote>\n<h2 id=\"Kafka의-트랜잭션\" style=\"position:relative;\">Kafka의 트랜잭션<a href=\"#Kafka%EC%9D%98-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98\" aria-label=\"Kafka의 트랜잭션 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Kafka는 트랜잭션 API를 통해 여러 파티션에 걸친 트랜잭션 연산을 지원한다.\n이를 통해 생산자는 메시지 배치를 여러 파티션에 전송하여 모든 메시지가 최종적으로 모든 소비자에게 표시되거나 아예 표시되지 않도록 할 수 있다.\n또한 이 기능을 사용하면 처리한 데이터와 함께 동일한 트랜잭션에서 소비자 오프셋을 커밋할 수 있어 엔드투엔드로 정확히 한 번만 메시지를 전달할 수 있다.</p>\n<p>소비자 측에서는 격리 수준 소비자 구성을 통해 표현되는 트랜잭션 메시지를 읽는 두 가지 옵션이 있다.</p>\n<p>read<em>committed: 트랜잭션의 일부가 아닌 메시지를 읽는 것 외에도 트랜잭션이 커밋된 후 트랜잭션의 일부인 메시지를 읽을 수도 있다.\nread</em>uncommitted: 트랜잭션이 커밋될 때까지 기다리지 않고 오프셋 순서대로 모든 메시지를 읽는다.\n트랜잭션을 사용하려면, 올바른 격리 수준을 사용하도록 소비자를 구성하고, 새로운 생산자 API를 사용하고, 생산자 구성 트랜잭션.id를 고유 ID로 설정해야 한다.\n이 고유 ID는 애플리케이션 재시작 시 트랜잭션 상태의 연속성을 제공하는 데 필요하다.</p>\n<h2 id=\"Kafka의-정확히-한-번-스트림-처리\" style=\"position:relative;\">Kafka의 정확히 한 번 스트림 처리<a href=\"#Kafka%EC%9D%98-%EC%A0%95%ED%99%95%ED%9E%88-%ED%95%9C-%EB%B2%88-%EC%8A%A4%ED%8A%B8%EB%A6%BC-%EC%B2%98%EB%A6%AC\" aria-label=\"Kafka의 정확히 한 번 스트림 처리 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>스트림 애플리케이션에서 정확히 한 번의 시맨틱을 보장하려면 \"processing.guarantee=exactly_once\" 구성을 설정하면 된다.\n이렇게 하면 모든 처리 작업과 해당 작업에서 생성된 모든 구체화된 상태가 Kafka에 정확히 한 번만 기록된다.</p>\n<p>그러나 정확히 한 번의 의미론은 Kafka 스트림의 내부 처리 범위에서만 보장된다.\n예를 들어, 스트림으로 작성된 이벤트 스트리밍 앱이 원격 저장소를 업데이트하기 위해 RPC 호출을 수행하거나 사용자 정의 클라이언트를 사용하여 카프카 토픽을 직접 읽거나 쓰는 경우, 이러한 외부 요소에 의한 부작용은 정확히 한 번 보장되지 않을 수 있다.</p>\n<blockquote>\n<p>이것이 바로 Kafka의 Streams API가 제공하는 정확히 한 번 보장이 지금까지 모든 스트림 처리 시스템이 제공한 가장 강력한 보장인 이유입니다. Kafka에서 읽은 데이터, Streams 앱에 의해 Kafka로 구체화된 모든 상태에서 Kafka에 다시 기록된 최종 출력으로 확장되는 스트림 처리 애플리케이션에 대해 종단 간 정확히 한 번 보장을 제공합니다. 상태를 구체화하기 위해 외부 데이터 시스템에만 의존하는 스트림 처리 시스템은 정확히 한 번 스트림 처리에 대한 약한 보장을 지원합니다. 스트림 처리를 위한 소스로 Kafka를 사용하고 오류를 복구해야 하는 경우에도 메시지를 다시 사용하고 재처리하기 위해 Kafka 오프셋을 되감기만 할 수 있지만 외부 시스템에서 연결된 상태를 롤백할 수 없으므로 상태 업데이트가 멱등성이 아닌 경우 잘못된 결과가 발생합니다.</p>\n</blockquote>\n<p>스트림 처리 시스템의 핵심 질문은 \"처리 도중에 인스턴스 중 하나가 충돌하더라도 스트림 처리 애플리케이션이 올바른 결과를 얻을 수 있는가?\" 이다.\n이를 위해 스트림 처리는 카프카 토픽에서 읽기, 처리 및 쓰기 작업으로 이루어진다.\n소비자가 카프카 토픽에서 메시지를 읽어와서 처리 로직에 의해 변환하거나 상태를 수정한 후, 생산자가 결과 메시지를 다른 카프카 토픽에 기록한다.\n정확히 한 번 스트림 처리는 이러한 작업들을 정확히 한 번만 실행하는 기능을 의미한다.\n이것은 입력 메시지의 누락이나 중복된 출력이 발생하지 않도록 하는 것을 의미한다.\n이는 사용자가 스트림 프로세서에 정확히 한 번만 실행되는 동작을 기대하는 것이다.</p>\n<p>이것 외에도 고려해야 할 다른 많은 실패 시나리오가 있다.</p>\n<ul>\n<li>스트림 프로세서는 여러 소스 토픽에서 입력을 받을 수 있으며, 이러한 소스 토픽의 순서는 여러 번 실행할 때 결정적이지 않다. 따라서 여러 소스 토픽에서 입력을 받는 스트림 프로세서를 다시 실행하면 다른 결과가 나올 수 있다..</li>\n<li>마찬가지로 스트림 프로세서는 여러 대상 토픽에 대한 출력을 생성할 수 있다. 프로듀서가 여러 토픽에 걸쳐 원자 쓰기를 수행할 수 없는 경우 일부(전부는 아님) 파티션에 대한 쓰기가 실패하면 프로듀서 출력이 올바르지 않을 수 있다.</li>\n<li>스트림 프로세서는 스트림 API가 제공하는 관리 상태 기능을 사용하여 여러 입력에 걸쳐 데이터를 집계하거나 조인할 수 있다. 스트림 프로세서의 인스턴스 중 하나에 장애가 발생하면 해당 스트림 프로세서 인스턴스에서 구현된 상태를 롤백할 수 있어야 한다. 인스턴스를 다시 시작할 때 처리를 재개하고 해당 상태를 다시 생성할 수 있어야 한다.</li>\n<li>스트림 프로세서는 외부 데이터베이스에서 보강 정보를 조회하거나 대역 외로 업데이트되는 서비스를 호출할 수 있다. 외부 서비스에 의존하면 스트림 프로세서는 근본적으로 비결정적이기 때문에 스트림 프로세서가 두 번 실행되는 사이에 외부 서비스가 내부 상태를 변경하면 다운스트림에서 잘못된 결과를 초래할 수 있다.     </li>\n</ul>\n<p>특히 비결정적 연산 및 애플리케이션에서 계산된 영구 상태의 변경과 함께 실패 및 재시작이 발생하면 중복뿐만 아니라 잘못된 결과도 발생할 수 있다.\n예를 들어, 한 처리 단계에서 표시된 이벤트 수를 계산하는 경우, 업스트림 처리 단계에서 중복이 발생하면 다운스트림에서 잘못된 카운트가 발생할 수 있습니다. 따라서 \"정확히 한 번만 스트림 처리\"라는 문구를 한정해야 합니다. 이는 토픽에서 소비하고, 카프카 토픽에서 중간 상태를 구체화하여 하나로 생성하는 것을 의미하지만, 메시지에서 수행되는 모든 가능한 계산이 스트림 API를 사용하는 것은 아니다.\n일부 계산(예: 외부 서비스에 의존하거나 여러 소스 토픽에서 소비하는 경우)은 근본적으로 비결정적이다.</p>\n<blockquote>\n<p>\"결정론적 연산에 대한 정확한 한 번 스트림 처리 보장을 생각하는 올바른 방법은 읽기-처리-쓰기 작업의 출력이 스트림 프로세서가 각 메시지를 정확히 한 번만 볼 때와 동일한지, 즉 오류가 발생하지 않은 경우와 동일한지를 보장하는 것입니다.”</p>\n</blockquote>\n<h2 id=\"비결정적-연산에서-정확히-한-번이란\" style=\"position:relative;\">비결정적 연산에서 정확히 한 번이란?<a href=\"#%EB%B9%84%EA%B2%B0%EC%A0%95%EC%A0%81-%EC%97%B0%EC%82%B0%EC%97%90%EC%84%9C-%EC%A0%95%ED%99%95%ED%9E%88-%ED%95%9C-%EB%B2%88%EC%9D%B4%EB%9E%80\" aria-label=\"비결정적 연산에서 정확히 한 번이란 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>예를 들어, 들어오는 이벤트의 실행 카운트를 유지하는 동일한 스트림 프로세서가 외부 서비스에서 지정한 조건을 만족하는 이벤트만 카운트하도록 수정되었다고 가정해 봅자.\n기본적으로 이 작업은 외부 조건이 스트림 프로세서를 두 번 실행하는 사이에 변경되어 다운스트림에서 다른 결과를 초래할 수 있기 때문에 본질적으로 결정론적이지 않다.\n그렇다면 이와 같은 결정론적이지 않은 연산에 대한 정확한 1회 보장은 어떻게 생각하는 것이 좋을까?</p>\n<p>\"결정론적이지 않은 연산에 대한 정확한 1회 보장을 생각하는 올바른 방법은 읽기-처리-쓰기 스트림 처리 작업의 출력이 결정론적이지 않은 입력의 합법적 값 조합에 의해 생성되는 합법적 출력의 하위 집합에 속하도록 하는 것이다\"</p>\n<p>따라서 위의 예제 스트림 프로세서의 경우, 현재 카운트가 31이고 입력 이벤트 값이 2인 경우,\n실패 시 올바른 출력은 {31, 33} 중 하나만 가능하다.\n외부 조건에 따라 입력 이벤트가 버려진 경우 31, 그렇지 않은 경우 33입니다.</p>\n<h2 id=\"정리\" style=\"position:relative;\">정리<a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>결과적으로, 카프카의 강력한 기본 요소에 의존하는 단순하면서도 효과적인 디자인 되었다.</p>\n<p>트랜잭션 로그는 카프카 토픽이므로 내구성이 보장된다.\n새로 도입된 트랜잭션 코디네이터는 브로커 내에서 실행되며, 장애 처리를 위해 Kafka의 리더 선출 알고리즘을 자연스럽게 활용한다.\nKafka의 Streams API로 구축된 스트림 처리 애플리케이션의 경우, 상태 저장소와 입력 오프셋의 소스가 Kafka 토픽이라는 사실을 활용하여 읽기-처리-쓰기 작업 전반에 걸쳐 정확히 한 번만 보장할 수 있다.</p>\n<h2 id=\"참조\" style=\"position:relative;\">참조<a href=\"#%EC%B0%B8%EC%A1%B0\" aria-label=\"참조 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><a href=\"https://www.confluent.io/blog/exactly-once-semantics-are-possible-heres-how-apache-kafka-does-it/\">https://www.confluent.io/blog/exactly-once-semantics-are-possible-heres-how-apache-kafka-does-it/</a></p>","fields":{"slug":"/Exactly_Once_Semantics/","thumbnail":null},"frontmatter":{"date":"June 14, 2023","update":"Jun 14, 2023","title":"카프카는 어떻게 Exactly-Once Semantics 보장하나?","description":null,"tags":["카프카"],"thumbnail":null}},{"excerpt":"팩토리 패턴 구상 클래스의 인스턴스 생성 부분을 캡슐화하기 피자 인스턴스를 만드는 구상 클래스를 선택하는 부분이 상황이 변하면 코드를 변경해야 한다. 객체 생성 부분 캡슐화 하기 피자 인스턴스 생성 부분을 SimplePizzaFactory로 넘겼을 때의 장점은? 팩토리를 사용하지 않으면 피자 인스턴스를 생성하는 부분이 많아 생성하는 작업이 변경되었을 때 …","html":"<h2 id=\"팩토리-패턴\" style=\"position:relative;\">팩토리 패턴<a href=\"#%ED%8C%A9%ED%86%A0%EB%A6%AC-%ED%8C%A8%ED%84%B4\" aria-label=\"팩토리 패턴 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"구상-클래스의-인스턴스-생성-부분을-캡슐화하기\" style=\"position:relative;\">구상 클래스의 인스턴스 생성 부분을 캡슐화하기<a href=\"#%EA%B5%AC%EC%83%81-%ED%81%B4%EB%9E%98%EC%8A%A4%EC%9D%98-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-%EC%83%9D%EC%84%B1-%EB%B6%80%EB%B6%84%EC%9D%84-%EC%BA%A1%EC%8A%90%ED%99%94%ED%95%98%EA%B8%B0\" aria-label=\"구상 클래스의 인스턴스 생성 부분을 캡슐화하기 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Pizza</span> <span class=\"token function\">orderPizza</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">Pizza</span> pizz<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">equlas</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cheese\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\tpizza <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CheesePizza</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">equlas</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"greek\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\tpizza <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GreekPizza</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> \t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">equlas</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"veggie\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\tpizza <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">VeggiePizza</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">return</span> pizza<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>피자 인스턴스를 만드는 구상 클래스를 선택하는 부분이 상황이 변하면 코드를 변경해야 한다.</li>\n</ul>\n<!-- more -->\n<h3 id=\"객체-생성-부분-캡슐화-하기\" style=\"position:relative;\">객체 생성 부분 캡슐화 하기<a href=\"#%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1-%EB%B6%80%EB%B6%84-%EC%BA%A1%EC%8A%90%ED%99%94-%ED%95%98%EA%B8%B0\" aria-label=\"객체 생성 부분 캡슐화 하기 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SimplePizzaFactory</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Pizza</span> <span class=\"token function\">createPizza</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">equlas</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cheese\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\tpizza <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CheesePizza</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">equlas</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"greek\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\tpizza <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GreekPizza</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> \t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">equlas</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"veggie\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\tpizza <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">VeggiePizza</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\n\t\t<span class=\"token keyword\">return</span> pizza<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>피자 인스턴스 생성 부분을 SimplePizzaFactory로 넘겼을 때의 장점은?</p>\n<ul>\n<li>팩토리를 사용하지 않으면 피자 인스턴스를 생성하는 부분이 많아 생성하는 작업이 변경되었을 때 생성하는 모든 부분을 고쳐줘야 한다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"클라이언트-코드-수정\" style=\"position:relative;\">클라이언트 코드 수정<a href=\"#%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8-%EC%BD%94%EB%93%9C-%EC%88%98%EC%A0%95\" aria-label=\"클라이언트 코드 수정 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PizzaStore</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token class-name\">SimplePizzaFactory</span> factory<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// 생성자</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Pizza</span> <span class=\"token function\">orderPizza</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">Pizza</span> pizza<span class=\"token punctuation\">;</span>\n\n\t\tpizza <span class=\"token operator\">=</span> factory<span class=\"token punctuation\">.</span><span class=\"token function\">createPizza</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\tpizza<span class=\"token punctuation\">.</span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tpizza<span class=\"token punctuation\">.</span><span class=\"token function\">bake</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tpizza<span class=\"token punctuation\">.</span><span class=\"token function\">cut</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tpizza<span class=\"token punctuation\">.</span><span class=\"token function\">box</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> pizza<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"팩토리-메서드-패턴\" style=\"position:relative;\">팩토리 메서드 패턴<a href=\"#%ED%8C%A9%ED%86%A0%EB%A6%AC-%EB%A9%94%EC%84%9C%EB%93%9C-%ED%8C%A8%ED%84%B4\" aria-label=\"팩토리 메서드 패턴 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>요구사항이 바뀌어 피자를 각 지점마다 그 지역의 특성과 입맛을 반영한 다양한 스타일의 피자를 만들어야 된다면?</li>\n<li>PizzaStore 클래스를 추상 클래스로 변경</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PizzaStore</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Pizza</span> <span class=\"token function\">orderPizza</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">Pizza</span> pizza<span class=\"token punctuation\">;</span>\n\n\t\tpizza <span class=\"token operator\">=</span> <span class=\"token function\">createPizza</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\tpizza<span class=\"token punctuation\">.</span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tpizza<span class=\"token punctuation\">.</span><span class=\"token function\">bake</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tpizza<span class=\"token punctuation\">.</span><span class=\"token function\">cut</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tpizza<span class=\"token punctuation\">.</span><span class=\"token function\">box</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> pizza<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">abstract</span> <span class=\"token class-name\">Pizza</span> <span class=\"token function\">createPizza</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>각 지점에 맞는 서브클래스를 생성(<code class=\"language-text\">NYPizzaStore</code>, <code class=\"language-text\">ChicagoPizzastore</code>, <code class=\"language-text\">CaliforniaPizzaStore</code>)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NYPizzaSotre</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">PizzaStore</span> <span class=\"token punctuation\">{</span>\n\t\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Pizza</span> <span class=\"token function\">createPizza</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">equlas</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cheese\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\tpizza <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NYStyleCheesePizza</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">equlas</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"greek\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\tpizza <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NYStyleGreekPizza</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> \t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">equlas</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"veggie\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\tpizza <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NYStyleVeggiePizza</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\n\t\t<span class=\"token keyword\">return</span> pizza<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"팩토리-메서드-패턴의-정의\" style=\"position:relative;\">팩토리 메서드 패턴의 정의<a href=\"#%ED%8C%A9%ED%86%A0%EB%A6%AC-%EB%A9%94%EC%84%9C%EB%93%9C-%ED%8C%A8%ED%84%B4%EC%9D%98-%EC%A0%95%EC%9D%98\" aria-label=\"팩토리 메서드 패턴의 정의 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>팩토리 메서드 패턴에서는 객체를 생성할 때 필요한 인터페이스를 만든다.</li>\n<li>어떤 클래스의 인서턴스를 만들지는 서브클래스에서 결정한다.</li>\n<li>팩토리 메서드 패턴을 사용하면 클래스 인스턴스 만드는 일을 서브 클래스에게 맡기게 된다.</li>\n</ul>\n<p><img src=\"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/76e137c9-a893-4709-9681-52da226edbc0/Untitled.png\" alt=\"Untitled\"></p>\n<ul>\n<li><strong>Product - 생성될 객체의 인터페이스</strong></li>\n<li><strong>ConcreteProduct - Product 인터페이스를 구현한 구상 클래스.</strong></li>\n<li><strong>Creator - 객체를 생성하는 팩토리 메소드를 가진 인터페이스</strong></li>\n<li><strong>ConcreteCreator - Creator 인터페이스를 구현한 구상 클래스.</strong></li>\n</ul>\n<h3 id=\"의존성-역전-원칙\" style=\"position:relative;\">의존성 역전 원칙<a href=\"#%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%97%AD%EC%A0%84-%EC%9B%90%EC%B9%99\" aria-label=\"의존성 역전 원칙 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<aside>\n💡 추상화된 것에 의존하게 만들고 구상 클래스에 의존하지 않게 만든다.\n</aside>\n<ul>\n<li>\n<p>고수준 구성 요소가 저수준 구성 요소에 의존하면 안되며, 항상 추상화에 의존하게 만들어야 한다.</p>\n<ul>\n<li>변수에 구상 클래스의 레퍼런스를 저장하지 않는다.</li>\n<li>new 연산자는 구상 클래스를 사용하게 되므로 팩토리를 써서 방지</li>\n<li>구상 클래스에서 유도된 클래스를 만들지 맙시다.</li>\n<li>인터페이스나 추상 클래스처럼 추상화된 것으로부터 클래스를 만들어야 된다.</li>\n<li>베이스 클래스에 이미 구현되어 있는 메소드를 오버라이드하지 않는다.</li>\n<li>이미 구현되어 있는 메서드를 오버라이드 한다면 베이스 클래스가 제대로 추상화되지 않았다.</li>\n<li>베이스 클래스에서 메서드를 정의할 때는 모든 서브클래스에서 공유할 수 있는 것만 정의해야한다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"추상-팩토리-패턴의-정의\" style=\"position:relative;\">추상 팩토리 패턴의 정의<a href=\"#%EC%B6%94%EC%83%81-%ED%8C%A9%ED%86%A0%EB%A6%AC-%ED%8C%A8%ED%84%B4%EC%9D%98-%EC%A0%95%EC%9D%98\" aria-label=\"추상 팩토리 패턴의 정의 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>추상 팩토리 패턴은 구상 클래스에 의존하지 않고도 서로 연관되거나 의존적인 객체로 이루어진 제품군을 생산하는 인터페이스를 제공합니다. 구상 클래스는 서브 클래스에서 만듭니다.</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/de39a91d2147771b4badfb54d79d5092/973af/img_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85.88235294117648%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACe0lEQVR42p1Ty27TQBTN37FhB+qnwJJFV3SFQKpgxapkhxBUbEC0KmpTlDRPx0naxImbeBLbiR+J49oeO4e5owZU6INi6VqWxz5zXpPDNVeSJJhMJuh0OigWi+j3+7BtG/9y5a57maYpBoMB2u02er0eFosFlsslVqvV/wFyztHtdlGpVNBqqRiNhphNbQGY/Zp7ARKT+XyO6XQK3/fh+gHCC34/yQQSBIEEsSxbeGZJMJ5mCKwmptoBLO0QVu8A3qiMLMtuB6QPKIh6vY5yuSy9c10H8yCCebSJ+s5DVPMb0D8+glt4iiiO1lRuBjRNE81mE2dnZ5Ip5wmCZYzJ4TO08g+gfdiA//UxopMniKI7AEnybDaDpmlydF0X0i3ESQqmvMfp/hbOj7dhHL+A2cjL4O4MhUDjOJY9DMNQ1oWYRzGXwPS8EIx5tro9lHW/CIS6R0VOhEck2XVdOSQtFu+q1QpOO23wJL6bIZV3OBzCMBhSwYKI0Ca+78myk0xaZ2NLpn8joOM4MgxVDE9FfVyGzvfXqH17g8CfSuCuCKrRqCMII1iDEpQvW/AmnUursquA1DfDMGCK2hBgODcxruWhFd/Bc0z5oS0CYozBny9h6lUY1R14Vldu9hfgn8GQXyRR0xkaSlNa8Xs9k15GPEVP60NVVRnk+t8c3Si99awDomSp6EwwpxO07iqtk380jI1hjEZILiskAa8yE8HM+pi0djFsfEJy4craklQ6ilwoC5whtB9v5Vz4BhZBKE8VWUah5cg/Gs9zRcciaMoeSrubOPn8HOPzNhzXR6lURKFwhLFpg+kK1L2XUPdfgQ0UkbiJWq0GRVHk6foJpjENiJTi3HUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/de39a91d2147771b4badfb54d79d5092/ca1dc/img_2.png\"\n        srcset=\"/static/de39a91d2147771b4badfb54d79d5092/e7570/img_2.png 170w,\n/static/de39a91d2147771b4badfb54d79d5092/f46e7/img_2.png 340w,\n/static/de39a91d2147771b4badfb54d79d5092/ca1dc/img_2.png 680w,\n/static/de39a91d2147771b4badfb54d79d5092/02d09/img_2.png 1020w,\n/static/de39a91d2147771b4badfb54d79d5092/9d567/img_2.png 1360w,\n/static/de39a91d2147771b4badfb54d79d5092/973af/img_2.png 1956w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<h3 id=\"팩토리-메서드-패턴과-추상-팩토리-패턴의-차이\" style=\"position:relative;\">팩토리 메서드 패턴과 추상 팩토리 패턴의 차이<a href=\"#%ED%8C%A9%ED%86%A0%EB%A6%AC-%EB%A9%94%EC%84%9C%EB%93%9C-%ED%8C%A8%ED%84%B4%EA%B3%BC-%EC%B6%94%EC%83%81-%ED%8C%A9%ED%86%A0%EB%A6%AC-%ED%8C%A8%ED%84%B4%EC%9D%98-%EC%B0%A8%EC%9D%B4\" aria-label=\"팩토리 메서드 패턴과 추상 팩토리 패턴의 차이 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>팩터리 메서드 패턴은 하나의 메서드가 여러 객체를 생성한다</li>\n<li>추상 팩토리 패턴은 팩터리 자체가 인터페이고 서브 클래스가 여러 객체를 생성한다.</li>\n<li>팩터리 메서드 패턴은 클라이언트와 구상 클래스를 분리시켜야할 때 사용한다.</li>\n<li>\n<p>추상 팩터리 패턴은 하나의 제품군을 생성할 때 사용한다.</p>\n<ul>\n<li>뉴욕지점의 제품군(Dough, Sauce, Cheese, Vaggies 등)</li>\n<li>제품군을 합치는 부분은 클라이언트의 책임</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"싱글톤-패턴\" style=\"position:relative;\">싱글톤 패턴<a href=\"#%EC%8B%B1%EA%B8%80%ED%86%A4-%ED%8C%A8%ED%84%B4\" aria-label=\"싱글톤 패턴 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li>싱글턴 패턴은 클래스 인스턴스를 하나만 만들고, 그 인스턴스로의 전역 접근을 제공</li>\n</ul>\n<h3 id=\"고전적인-구현-방식\" style=\"position:relative;\">고전적인 구현 방식<a href=\"#%EA%B3%A0%EC%A0%84%EC%A0%81%EC%9D%B8-%EA%B5%AC%ED%98%84-%EB%B0%A9%EC%8B%9D\" aria-label=\"고전적인 구현 방식 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Singleton</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> instance<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>instance <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n\t\t\tinstance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>멀티스레드 환경에서 두 스레드가 동시에 getInstance를 호출할 때 인스턴스가 2개 만들어질 가능성이 있다.</li>\n</ul>\n<h3 id=\"동기화를-이용한-구현\" style=\"position:relative;\">동기화를 이용한 구현<a href=\"#%EB%8F%99%EA%B8%B0%ED%99%94%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EA%B5%AC%ED%98%84\" aria-label=\"동기화를 이용한 구현 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Singleton</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> instance<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">synchronized</span> <span class=\"token class-name\">Singleton</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>instance <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n\t\t\tinstance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>synchronized 키워드를 추가하면 한 스레드가 메소드 사용을 끝내기 전까지 다른 스레드는 기다리게 된다.</li>\n<li>하지만 synchronized 키워드를 사용하면 성능이 저하되고, 객체가 생성할 시점에만 동기화가 필요한데 자원을 낭비하게 된다.</li>\n</ul>\n<h3 id=\"static-initializer-를-이용한-구현\" style=\"position:relative;\">static initializer 를 이용한 구현<a href=\"#static-initializer-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EA%B5%AC%ED%98%84\" aria-label=\"static initializer 를 이용한 구현 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Singleton</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>클래스가 로딩될 때 JVM에서 Singleton이 하나뿐인 인서턴스를 생성해준다.</li>\n<li>하지만 생성시점을 JVM에서 관리하기 때문에 lazy loading 처럼 생성시점을 컨트롤할 수가 없다.</li>\n</ul>\n<h3 id=\"DCL을-이용한-구현\" style=\"position:relative;\">DCL을 이용한 구현<a href=\"#DCL%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EA%B5%AC%ED%98%84\" aria-label=\"DCL을 이용한 구현 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>DCL(Double-Checked Locking)을 사용하면 인스턴스가 생성되어 있는지 확인 한 다음 생성되어 있지 않을 때만 동기화할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Singleton</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> volaile <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> instance<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>instance <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>instance <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t\tinstance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"enum-을-사용한-구현\" style=\"position:relative;\">enum 을 사용한 구현<a href=\"#enum-%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%9C-%EA%B5%AC%ED%98%84\" aria-label=\"enum 을 사용한 구현 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">enum</span> <span class=\"token class-name\">Singleton</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token constant\">UNIQUE_INSTACE</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SinlegonClient</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token class-name\">Singleton</span> singleton <span class=\"token operator\">=</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UNIQUE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">INSTANCE</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","fields":{"slug":"/create/","thumbnail":null},"frontmatter":{"date":"April 10, 2022","update":"Apr 10, 2022","title":"디자인 패턴 - 생성 패턴","description":null,"tags":["디자인 패턴"],"thumbnail":null}},{"excerpt":"데코레이터 패턴 OCP 살펴보기 클래스는 확장에는 열려 있어야 하지만 변경에는 닫혀 있어야 한다. 기존 코드를 변경하지 않아도 확장할 수 있어야 한다. 옵저버 패턴을 예로 들면 옵저버를 새로 추가하면 주제에 코드를 추가하지 않으면서도 얼마든지 확장이 가능하다. 모든 부분에서 OCP를 준수해야 하는가? 현실적으로도 불가능하고 OCP를 지키다 보면 추상화가 …","html":"<h2 id=\"데코레이터-패턴\" style=\"position:relative;\">데코레이터 패턴<a href=\"#%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0-%ED%8C%A8%ED%84%B4\" aria-label=\"데코레이터 패턴 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"OCP-살펴보기\" style=\"position:relative;\">OCP 살펴보기<a href=\"#OCP-%EC%82%B4%ED%8E%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"OCP 살펴보기 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>\n<p>클래스는 확장에는 열려 있어야 하지만 변경에는 닫혀 있어야 한다.</p>\n<ul>\n<li>기존 코드를 변경하지 않아도 확장할 수 있어야 한다.</li>\n<li>옵저버 패턴을 예로 들면 옵저버를 새로 추가하면 주제에 코드를 추가하지 않으면서도 얼마든지 확장이 가능하다.</li>\n</ul>\n</li>\n<li>\n<p>모든 부분에서 OCP를 준수해야 하는가?</p>\n<ul>\n<li>현실적으로도 불가능하고 OCP를 지키다 보면 추상화가 필요한데, 추상화를 하다 보면 코드가 복잡해진다.</li>\n<li>그래서 디자인한 것 중에서 가장 바뀔 가능성이 높은 부분을 중심적으로 살펴보고 OCP를 적용하는 방법이 좋다.</li>\n</ul>\n</li>\n</ul>\n<!-- more -->\n<aside>\n💡 무조건 OCP를 적용한다면 괜히 쓸데없는 일을 하며 시간을 낭비할 수 있으며, 필요 이상으로 복잡하고 이해하기 힘든 코드를 만들게 되는 부작용이 발생할 수 있다.\n</aside>\n<h3 id=\"데코레이터-패턴의-정의\" style=\"position:relative;\">데코레이터 패턴의 정의<a href=\"#%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0-%ED%8C%A8%ED%84%B4%EC%9D%98-%EC%A0%95%EC%9D%98\" aria-label=\"데코레이터 패턴의 정의 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>데코레이터 패턴은 객체에 추가 요소를 동적으로 더할 수 있다.</li>\n<li>데코레이터를 사용하면 서브클래스를 만들 때보다 훨씬 유연하게 기능을 확장할 수 있다.</li>\n</ul>\n<p><img src=\"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a1d2e1b7-7f8f-4fe6-af62-bc391740ff17/Untitled.png\" alt=\"Untitled\"></p>\n<ul>\n<li>\n<p>데코레이터가 컴포넌트를 상속받는 이유</p>\n<ul>\n<li>상속으로 행동을 물려받는 것은 아님</li>\n<li>행동은 기본 구성 요소와는 데코레이터 등을 인스턴스 변수에 저장하여 호출하는 식</li>\n<li>데코레이터로 감싸는 객체와 형식을 맞추기 위해 상속 (원래 있던 구성 요소가 들어갈 자리에 자기가 들어갈 수 있어야 하므로)</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"데코레이터-패턴-구현하기\" style=\"position:relative;\">데코레이터 패턴 구현하기<a href=\"#%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0-%ED%8C%A8%ED%84%B4-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0\" aria-label=\"데코레이터 패턴 구현하기 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// Component 클래스</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> calss <span class=\"token class-name\">Beverage</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">String</span> description <span class=\"token operator\">=</span> <span class=\"token string\">\"제목 없음\"</span><span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getDescription</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> description<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">double</span> <span class=\"token function\">cost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 데코레이터 클래스(첨가물 클래스)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CondimentDecorator</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Beverage</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 형식을 맞추기 위해 상속</span>\n\t<span class=\"token class-name\">Beverage</span> beverage<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 데코레이터가 감쌀 음료를 나타냄</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getDescription</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>음료 코드 구현</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Espresso</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Beverage</span> <span class=\"token punctuation\">{</span>\n\t\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Espresso</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>\n\t\t\tdescription <span class=\"token operator\">=</span> <span class=\"token string\">\"에스프레소\"</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> doublc <span class=\"token function\">cost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token number\">1.99</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HouseBlend</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Beverage</span> <span class=\"token punctuation\">{</span>\n\t\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Espresso</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>\n\t\t\tdescription <span class=\"token operator\">=</span> <span class=\"token string\">\"하우스 블렌드\"</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> doublc <span class=\"token function\">cost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token number\">0.99</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>첨가물 코드 구현</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Mocha</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">CondimentDecorator</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Mocha</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Beverage</span> beverage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>beverage <span class=\"token operator\">=</span> beverage<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getDescription</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> beverage<span class=\"token punctuation\">.</span><span class=\"token function\">getDescription</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\", 모카\"</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">double</span> <span class=\"token function\">cost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> beverage<span class=\"token punctuation\">.</span><span class=\"token function\">cost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>테스트 코드</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 하우스 블렌드 커피 + 모카 2샷 + 휩 추가</span>\n<span class=\"token class-name\">Beverage</span> beverage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HouseBlend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbeverage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Mocha</span><span class=\"token punctuation\">(</span>beverage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbeverage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Mocha</span><span class=\"token punctuation\">(</span>beverage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbeverage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Whip</span><span class=\"token punctuation\">(</span>beverage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"정리\" style=\"position:relative;\">정리<a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>데코레이터 패턴의 의도는 감싸고 있는 객체에 행동을 추가하는 용도이다.</li>\n<li>만약 여러 단계의 데코레이터를 파고 들어가서 어떤 작업을 해야 한다면 데코레이터 패턴이 만들어진 의도와는 어긋난다.</li>\n<li>추상 구상 요소(Component) 가 아닌 특정 Concrete Component의 의존하여 어떤 작업을 해야하는 경우에는 데코레이터 패턴의 의도와는 맞지 않기 때문에 패턴 사용을 다시 생각해봐야 한다.</li>\n</ul>","fields":{"slug":"/struct/","thumbnail":null},"frontmatter":{"date":"April 07, 2022","update":"Apr 07, 2022","title":"디자인 패턴 - 구조 패턴","description":null,"tags":["디자인 패턴"],"thumbnail":null}},{"excerpt":"디자인 패턴- 행동 패턴 어떤 처리의 책임을 어느 객체에 할당하는 것이 좋은지, 알고리즘은 어느 객체에 정의하는 것이 좋은지 다룹니다. 객체들 간의 교류 방법에 대하여 정의한다. 행동 클래스 패턴 은 클래스 사이에 행동 책임을 분산하기 위해서 상속을 사용합니다. 행동 객체 패턴 은 상속보다는 복합을 통해서 객체 사이에 행동처리의 책임을 분산합니다. 전략 …","html":"<h2 id=\"디자인-패턴--행동-패턴\" style=\"position:relative;\">디자인 패턴- 행동 패턴<a href=\"#%EB%94%94%EC%9E%90%EC%9D%B8-%ED%8C%A8%ED%84%B4--%ED%96%89%EB%8F%99-%ED%8C%A8%ED%84%B4\" aria-label=\"디자인 패턴  행동 패턴 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li>어떤 처리의 책임을 어느 객체에 할당하는 것이 좋은지, 알고리즘은 어느 객체에 정의하는 것이 좋은지 다룹니다.</li>\n<li>객체들 간의 교류 방법에 대하여 정의한다.</li>\n<li><strong>행동 클래스 패턴</strong> 은 클래스 사이에 행동 책임을 분산하기 위해서 상속을 사용합니다.</li>\n<li><strong>행동 객체 패턴</strong> 은 상속보다는 복합을 통해서 객체 사이에 행동처리의 책임을 분산합니다.</li>\n</ul>\n<!-- more -->\n<h2 id=\"전략-패턴\" style=\"position:relative;\">전략 패턴<a href=\"#%EC%A0%84%EB%9E%B5-%ED%8C%A8%ED%84%B4\" aria-label=\"전략 패턴 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/480d5f2be7780c0795fbf788f0f65b2b/dface/img.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.705882352941174%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiklEQVR42mVSy27CQAzk//+AY4+8DhTEQy2PFhWoEBQ1BamgSFCEgIRkA2QTSA5Te0MCVQ+jXY/HY+8jpes6NE3DdDqFYRhwXRfH41HhcDgo8P50OlHuROuNvwdr9vs9UhywyXZrYrlckalFgqgoCAIFxzliszFIY1CRDSkl8RdcLhHO57PSsWlKShemaePxsYOHhyIKhRbG4wl+fpYQQsCyLAwGM2Qyz0ins2i3v7Bem8rQ931lxmBjHiLFR5DSw25nkrFQk3IiDMOkQNO+0Wj00Wq9o9sdU6No+tiMdYkhj8lBGAYJOOZjxfA873qHrlp931N715VJ03+GnIiTnuergmgvFdiEzeNmccy66D6Dm2HcwbIEer0pyuUXlEptdDqfWCzWGI104l5RLLbo6EPM5yv6FQs0m0PiGqjXexgOZ7BtcTPkLqZpkaCJXK6GbLaGSuUNur5CtdqhR6kgn69T/gWz2Yru8oO4muIKhSf0+5PI0LbtP/+JY4YQ9h1nXTnxT8dwHCf5h7/2mZnyemIdXAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/480d5f2be7780c0795fbf788f0f65b2b/dface/img.png\"\n        srcset=\"/static/480d5f2be7780c0795fbf788f0f65b2b/e7570/img.png 170w,\n/static/480d5f2be7780c0795fbf788f0f65b2b/f46e7/img.png 340w,\n/static/480d5f2be7780c0795fbf788f0f65b2b/dface/img.png 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<ul>\n<li>전략 패턴(Strategy Pattern)은 알고리즘군을 정의하고 캡슐화해서 각각의 알고리즘군을 수정해서 쓸 수 있게 해준다.</li>\n<li>전략 패턴을 사용하면 클라이언트로부터 알고리즘을 분리해서 독립적으로 변경할 수 있다.</li>\n</ul>\n<h3 id=\"디자인-원칙\" style=\"position:relative;\">디자인 원칙<a href=\"#%EB%94%94%EC%9E%90%EC%9D%B8-%EC%9B%90%EC%B9%99\" aria-label=\"디자인 원칙 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>\n<p>애플리케이션에서 달라지는 부분을 찾아내고 달라지지 않는 부분과 분리한다.</p>\n<ul>\n<li>달라지는 부분을 찾아서 나머지 코드에 영향을 주지 않도록 캡슐화한다.</li>\n<li>Context 달라지지 않는 부분, Strategy 달라지는 부분ㅔ</li>\n</ul>\n</li>\n<li>\n<p>구현보다는 인터페이스 맞춰서 프로그래밍 한다.</p>\n<ul>\n<li>Context의 행동은 인터페이스로 정의되어 구체적으로 구현하지 않는다.</li>\n</ul>\n</li>\n<li>\n<p>상속보다는 구성을 활용한다.</p>\n<ul>\n<li>전략 패턴을 쓰지 않는다면 상속을 통해 서브 클래스에서 메서드를 오버라이딩 하여 행동을 바꿀 수 있다.</li>\n<li>Super 클래스에 의존성이 발생하고 필요하지 않은 부분도 상속해야 되는 문제점이 있다.</li>\n<li>구성(Composition)을 활용하면 시스템의 유연성을 크게 향상시킬 수 있다.</li>\n<li>알고리즘군을 별도의 클래스 집합으로 캡슐화할 수 있으며 구성 요소로 사용하는 객체에서 올바른 행동 인터페이스를 구현하기만 하면 실행 시에 행동을 바꿀 수 있다.</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"옵저버-패턴\" style=\"position:relative;\">옵저버 패턴<a href=\"#%EC%98%B5%EC%A0%80%EB%B2%84-%ED%8C%A8%ED%84%B4\" aria-label=\"옵저버 패턴 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li>옵저버 패턴(Observer Pattern)은 한 객체의 상태가 바뀌면 그 객체에 의존하는 다른 객체에게 연락이 가고 자동으로 내용이 갱신되는 방식으로 일대다(One To Many) 의존성을 정의합니다.</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin-bottom: 16px;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 461px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0e0265954cf0605d224a0a0b67e58b8a/31fe3/img_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.94117647058823%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnklEQVR42o2SR45CQQxE+/4XYgMsWLIgZ0TOOedQo+eZRg3SSFhqfX+HKid3PB61WCxUqVSUy+Xsy//hcNB6vVar1VImk9FsNtN4PDY7/lKppEKhoHK5bHYkEonI6U9IBHA4HOp2u+nxeGi1Wqnb7Wo+n6vZbKrX61ksfoB4+CkKicVicgB1Oh1zTCYTS6YKhO/1evWcGo1GajQaRor9+Xwa8el0Mn80GpUrFovK5/PWFsGAUwEC8/l8Np3k/X5vY9hut6aTxxdi4hiLw0lrzIUWwoTdbmcV/CfEfYqD2ZcOg9e93Vfn9VD8aN4AmQUA9/vdGD0gbWMLgbAR73OIJ8bbeA4W5si5pNNpe+jYSdhsNrbhwWBgo2Gu+LiIVCplPsYEcSKR+J0hm51Op6/vcrk0Zs4Esna7bYlcAQTMF2C2yzL8EuPxuBwVwZbNZl8n4ZNYyuVyebVMlRw0JMRSAMRvZ0MbBALEUti23zIvvEOqggAAyGgdHTtV9vt9OUDCYw6F4LDCb8TRNy+ZTKper6tWq9mrVqvWFi19KyzmB4zx3Makl9UPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/0e0265954cf0605d224a0a0b67e58b8a/31fe3/img_1.png\"\n        srcset=\"/static/0e0265954cf0605d224a0a0b67e58b8a/e7570/img_1.png 170w,\n/static/0e0265954cf0605d224a0a0b67e58b8a/f46e7/img_1.png 340w,\n/static/0e0265954cf0605d224a0a0b67e58b8a/31fe3/img_1.png 461w\"\n        sizes=\"(max-width: 461px) 100vw, 461px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Untitled</figcaption>\n  </figure></p>\n<ul>\n<li>Publish-Subscribe 패턴과는 다르다. Publish-Subscribe 패턴은 구독자가 서로 다른 유형의 메시지에 관심을 가질 수 있고 출판사와 구독자가 더 세세하게 분리할 수 있는 복잡한 패턴이다.</li>\n</ul>\n<h3 id=\"느슨한-결합의-위력\" style=\"position:relative;\">느슨한 결합의 위력<a href=\"#%EB%8A%90%EC%8A%A8%ED%95%9C-%EA%B2%B0%ED%95%A9%EC%9D%98-%EC%9C%84%EB%A0%A5\" aria-label=\"느슨한 결합의 위력 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>느슨한 결합(Loose Coupling)은 객체들이 상호작용할 수는 있지만, 서로를 잘 모르는 관계를 의미한다.</li>\n<li>\n<p>주제(Subject)클래스는 옵저버가 특정 인터페이스(Observer 인터페이스)를 구현한다는 사실만 안다.</p>\n<ul>\n<li>옵저버의 구상 클래스가 무엇인지, 옵저버가 무엇을 하는지는 알 필요가 업삳.</li>\n</ul>\n</li>\n<li>\n<p>옵저버는 언제든지 새로 추가할 수 있다.</p>\n<ul>\n<li>주제는 Observer 인터페이스에만 의존하므로 언제든지 새로운 옵저버를 추가할 수 있다.</li>\n</ul>\n</li>\n<li>\n<p>새로운 형식의 옵저버를 추가할 때도 변경할 필요가 없다.</p>\n<ul>\n<li>옵저버의 구상 클래스가 새로 생기더라도 주제 클래스는 그것을 신경 쓸 필요가 없다. Observer 인터페이스만 구현한다면 어떤 객체와도 상호작용이 가능하다.</li>\n</ul>\n</li>\n<li>\n<p>주제와 옵저버는 서로 독립적으로 재사용할 수 있다.</p>\n<ul>\n<li>둘이 서로 단단하게 결합되지 않기 때문이다.</li>\n</ul>\n</li>\n<li>\n<p>주제나 업저버가 달라져도 서로에게 영향을 미치지 않는다.</p>\n<ul>\n<li>구현에 의존하지 않고 인터페이스 의존하기 때문이다.</li>\n</ul>\n</li>\n</ul>\n<aside>\n💡 디자인 원칙   \n상호작용하는 객체 사이에는 가능하면 느슨한 결합을 사용한다.\n</aside>\n<h3 id=\"푸시-방식에서-풀-방식으로-바꾸기\" style=\"position:relative;\">푸시 방식에서 풀 방식으로 바꾸기<a href=\"#%ED%91%B8%EC%8B%9C-%EB%B0%A9%EC%8B%9D%EC%97%90%EC%84%9C-%ED%92%80-%EB%B0%A9%EC%8B%9D%EC%9C%BC%EB%A1%9C-%EB%B0%94%EA%BE%B8%EA%B8%B0\" aria-label=\"푸시 방식에서 풀 방식으로 바꾸기 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>주제가 옵저버에게 상태를 알리는 방식(푸시)는 Observer의 <code class=\"language-text\">update()</code> 메서드의 파라미터가 변경된다면 모든 구상 옵저버 클래스의 변경이 발생한다.</li>\n<li>옵저버가 주제로부터 상태를 끌어오는 방식(풀)로 바꾼다면 옵저버가 필요한 데이터를 골라서 가져올 수 있고 쉽게 확장할 수 있다.</li>\n</ul>\n<h4>주제에서 알림 보내기</h4>\n<ul>\n<li>옵저버의 update 메서드를 인자없이 호출하도록 주제 클래스의 <code class=\"language-text\">notifyObservers()</code> 메서드를 수정한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">nofifyObservers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Observer</span> observer <span class=\"token operator\">:</span> observers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\tobserver<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 파라미터 없이 호출</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>옵저버에서 알림 받기</h4>\n<ul>\n<li>Observer 인터페이스에서 update() 메서드의 매개변수 제거</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Observer</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">void</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Concreate Observer 클래스의 update 메서드를 주제의 데이터를 가져오도록 수정</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>temperature <span class=\"token operator\">=</span> weatherData<span class=\"token punctuation\">.</span><span class=\"token function\">getTeperature</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>humidity <span class=\"token operator\">=</span> weaterData<span class=\"token punctuation\">.</span><span class=\"token function\">getHumidity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"디자인-원칙-1\" style=\"position:relative;\">디자인 원칙<a href=\"#%EB%94%94%EC%9E%90%EC%9D%B8-%EC%9B%90%EC%B9%99-1\" aria-label=\"디자인 원칙 1 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<ul>\n<li>\n<p>애플리케이션에서 달리지는 부분을 찾아내고 달라지지 않는 부븐과 분리한다.</p>\n<ul>\n<li>옵저버 패턴에서 변하는 것은 주제의 상태와 옵저버의 개수와 형식이다.</li>\n<li>주제를 바꾸지 않고도 주제의 상태에 의존하는 객체들을 바꿀 수 있음</li>\n</ul>\n</li>\n<li>\n<p>구현보다는 인터페이스에 맞춰서 프로그래밍 한다.</p>\n<ul>\n<li>주제는 Subject 인터페이스로 Observer 인터페이스를 구현하는 객체들의 등록과 탈퇴를 관리하고 그런 객체들에게 상태를 알린다.</li>\n</ul>\n</li>\n<li>\n<p>상속보다는 구성을 사용한다.</p>\n<ul>\n<li>주제와 옵저버 사이의 관계는 상속이 아니라 구성으로 이루어진다.</li>\n</ul>\n</li>\n</ul>","fields":{"slug":"/behavior/","thumbnail":null},"frontmatter":{"date":"April 02, 2022","update":"Apr 02, 2022","title":"디자인 패턴 - 행동 패턴","description":null,"tags":["디자인 패턴"],"thumbnail":null}},{"excerpt":"@EnableAutoConfiguration Spring Boot 애플리케이션이 시작되면 spring-boot-autoconfigure 모듈에 미리 정의된 Configuration 클래스들이 자동으로 구성됩니다. (스프링 부트 자동 구성 목록) Auto Configuration이 실제 실행되는지 여부는 클래스 경로에 종속 클래스가 있는지 여부에 따라 달라…","html":"<h2 id=\"EnableAutoConfiguration\" style=\"position:relative;\">@EnableAutoConfiguration<a href=\"#EnableAutoConfiguration\" aria-label=\"EnableAutoConfiguration permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Spring Boot 애플리케이션이 시작되면 spring-boot-autoconfigure 모듈에 미리 정의된 Configuration 클래스들이 자동으로 구성됩니다. (<a href=\"https://docs.spring.io/spring-boot/docs/current/reference/html/auto-configuration-classes.html#appendix.auto-configuration-classes\">스프링 부트 자동 구성 목록</a>)</p>\n<p>Auto Configuration이 실제 실행되는지 여부는 클래스 경로에 종속 클래스가 있는지 여부에 따라 달라집니다.</p>\n<p>예를 들어, <code class=\"language-text\">@ConditionalOnClass</code> 는 클래스 패스에 특정 class가 존재할 때만 조건이 만족됩니다.</p>\n<!-- more -->\n<h2 id=\"Custom-AutoConfiguration-Starter-만들기\" style=\"position:relative;\">Custom AutoConfiguration Starter 만들기<a href=\"#Custom-AutoConfiguration-Starter-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"Custom AutoConfiguration Starter 만들기 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"1--applicationproperties-파일의-사용자-정의-속성\" style=\"position:relative;\">1.  <a href=\"http://application.properties\">application.properties</a> 파일의 사용자 정의 속성<a href=\"#1--applicationproperties-%ED%8C%8C%EC%9D%BC%EC%9D%98-%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%A0%95%EC%9D%98-%EC%86%8D%EC%84%B1\" aria-label=\"1  applicationproperties 파일의 사용자 정의 속성 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Data</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@ConfigurationProperties</span><span class=\"token punctuation\">(</span>prefix <span class=\"token operator\">=</span> <span class=\"token string\">\"custom\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomProperties</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> message<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> url<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>@ConfigurationProperties의 접두사와 클래스 필드 이름은 <a href=\"http://application.properties\">application.properties</a> 와 맵핑됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">custom<span class=\"token punctuation\">.</span>message <span class=\"token operator\">=</span> hello world\ncustom<span class=\"token punctuation\">.</span>url <span class=\"token operator\">=</span> localhost</code></pre></div>\n<h3 id=\"2--라이브러리용-빈-만들기\" style=\"position:relative;\">2.  라이브러리용 빈 만들기<a href=\"#2--%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%EC%9A%A9-%EB%B9%88-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"2  라이브러리용 빈 만들기 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomService</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">InitializingBean</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">CustomProperties</span> customProperties<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterPropertiesSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CustomService init\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message : {}\"</span><span class=\"token punctuation\">,</span> customProperties<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"url : {}\"</span><span class=\"token punctuation\">,</span> customProperties<span class=\"token punctuation\">.</span><span class=\"token function\">getUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"3-AutoConfiguration\" style=\"position:relative;\">3. AutoConfiguration<a href=\"#3-AutoConfiguration\" aria-label=\"3 AutoConfiguration permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@EnableConfigurationProperties</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CustomProperties</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomAutoConfiguration</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token annotation punctuation\">@Bean</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">CustomService</span> <span class=\"token function\">customService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CustomProperties</span> customProperties<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomService</span><span class=\"token punctuation\">(</span>customProperties<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"4-springfactories-파일-추가\" style=\"position:relative;\">4. spring.factories 파일 추가<a href=\"#4-springfactories-%ED%8C%8C%EC%9D%BC-%EC%B6%94%EA%B0%80\" aria-label=\"4 springfactories 파일 추가 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p><code class=\"language-text\">src/main/resources/META-INF</code> 경로에 다음 내용을 추가합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>autoconfigure<span class=\"token punctuation\">.</span></span>EnableAutoConfiguration</span><span class=\"token operator\">=</span>\\\n<span class=\"token class-name\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>autoconfigure<span class=\"token punctuation\">.</span>configure<span class=\"token punctuation\">.</span></span>CustomAutoConfiguration</span></code></pre></div>\n<h3 id=\"5-AutoConfiguration-사용\" style=\"position:relative;\">5. AutoConfiguration 사용<a href=\"#5-AutoConfiguration-%EC%82%AC%EC%9A%A9\" aria-label=\"5 AutoConfiguration 사용 permalink\" class=\"anchor-header after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>스타터를 사용할 프로젝트를 만들고 pom.xml에 종속성을 추가합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>dependency<span class=\"token punctuation\">></span></span>\n      <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>groupId<span class=\"token punctuation\">></span></span>com<span class=\"token punctuation\">.</span>example<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>groupId<span class=\"token operator\">></span>\n      <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>artifactId<span class=\"token punctuation\">></span></span>auto<span class=\"token operator\">-</span>configure<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>artifactId<span class=\"token operator\">></span>\n      <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>version<span class=\"token punctuation\">></span></span><span class=\"token number\">0.0</span><span class=\"token number\">.1</span><span class=\"token operator\">-</span><span class=\"token constant\">SNAPSHOT</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>version<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>dependency<span class=\"token operator\">></span></code></pre></div>\n<p><a href=\"http://application.properties\">application.properties</a> 파일에 사용자 정의 속성을 정의하고 프로젝트를 시작하면 다음과 같이 빈이 초기화되는 것을 볼 수 있습니다.</p>","fields":{"slug":"/spring-autoconfigure/","thumbnail":null},"frontmatter":{"date":"March 28, 2022","update":"Mar 28, 2022","title":"SpringBoot AutoConfiguration 시작하기","description":null,"tags":["스프링"],"thumbnail":null}}]},"totalMarkdown":{"group":[{"fieldValue":"AWS","totalCount":2},{"fieldValue":"JPA","totalCount":1},{"fieldValue":"Java","totalCount":10},{"fieldValue":"Tomcat","totalCount":2},{"fieldValue":"kernel","totalCount":1},{"fieldValue":"데이터 중심 애플리케이션 설계","totalCount":8},{"fieldValue":"데이터베이스","totalCount":2},{"fieldValue":"디자인 패턴","totalCount":3},{"fieldValue":"레디스","totalCount":1},{"fieldValue":"스프링","totalCount":5},{"fieldValue":"실무로 배우는 시스템 성능 최적화","totalCount":7},{"fieldValue":"카프카","totalCount":3}],"nodes":[{"fields":{"slug":"/java-synchronized/"}},{"fields":{"slug":"/mysql-transaction-lock/"}},{"fields":{"slug":"/socket_internal/"}},{"fields":{"slug":"/java-nio-selector/"}},{"fields":{"slug":"/java-nio-channel/"}},{"fields":{"slug":"/spring-core-container/"}},{"fields":{"slug":"/tomcat-connection/"}},{"fields":{"slug":"/java-nio-buffer/"}},{"fields":{"slug":"/socket_option/"}},{"fields":{"slug":"/tomcat/"}},{"fields":{"slug":"/java-concurrency-lock/"}},{"fields":{"slug":"/java-concurrency-deadlock/"}},{"fields":{"slug":"/java-concurrency-executor/"}},{"fields":{"slug":"/java-concurrency-model/"}},{"fields":{"slug":"/java-concurrency/"}},{"fields":{"slug":"/mysql-primary-key-design/"}},{"fields":{"slug":"/ehcache3/"}},{"fields":{"slug":"/jpa-slow-cause/"}},{"fields":{"slug":"/redis-event-notifications/"}},{"fields":{"slug":"/spring-cache-hierarchy/"}},{"fields":{"slug":"/java-collection-wrapper/"}},{"fields":{"slug":"/Spring Cloud AWS Messaging Module Best Practice/"}},{"fields":{"slug":"/Amazon SQS Deep Dive/"}},{"fields":{"slug":"/enabling_exactly_once_kafka_streams/"}},{"fields":{"slug":"/trasaction_in_kafka/"}},{"fields":{"slug":"/Exactly_Once_Semantics/"}},{"fields":{"slug":"/create/"}},{"fields":{"slug":"/struct/"}},{"fields":{"slug":"/behavior/"}},{"fields":{"slug":"/spring-autoconfigure/"}},{"fields":{"slug":"/ch7/"}},{"fields":{"slug":"/ch6/"}},{"fields":{"slug":"/ch5/"}},{"fields":{"slug":"/ch4/"}},{"fields":{"slug":"/ch3/"}},{"fields":{"slug":"/ch2/"}},{"fields":{"slug":"/ch1/"}},{"fields":{"slug":"/ch8/"}},{"fields":{"slug":"/ch7/"}},{"fields":{"slug":"/ch6/"}},{"fields":{"slug":"/ch5/"}},{"fields":{"slug":"/ch4/"}},{"fields":{"slug":"/ch3/"}},{"fields":{"slug":"/ch2/"}},{"fields":{"slug":"/ch1/"}}]}},"pageContext":{"skip":20,"totalPage":5,"currentPage":3}},"staticQueryHashes":[],"slicesMap":{}}